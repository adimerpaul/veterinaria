import{aM as lt,g as et,r as i,V as ot,k as at,a0 as d,o as r,a as o,b as t,w as s,f as m,Q as z,e as w,ao as U,al as F,aN as nt,u as st,c as E,a1 as B,a2 as x,a3 as h,t as n,Z as D,W as I,aO as M,h as rt}from"./index-CrC-fP_I.js";import{Q as A,b as R}from"./QSelect-DRBH6Im6.js";import{Q as L}from"./QForm-BR8Nab6C.js";import{Q as it}from"./QPagination-lpCf8U6n.js";import{Q as C}from"./QMarkupTable-Wc_5piZj.js";import{Q as H}from"./QSpace-6d9GSoAI.js";import{Q as dt}from"./QPage-CQKRXQLt.js";import{I as ut}from"./Imprimir-D3uOSMA-.js";import"./QMenu-BU68Jk_d.js";import"./QItemLabel-DziiQR3a.js";import"./format-hlGAdIUH.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./moment-C5S46NFB.js";const ct={class:"row"},pt={class:"col-12"},mt={class:"col-12 col-md-7"},vt={class:"row"},ft={class:"col-12 col-md-7"},bt={class:"col-12 col-md-3"},xt={class:"col-12 col-md-2 flex flex-center"},gt={class:"row"},ht={class:"col-12 flex flex-center"},Vt=["onClick"],_t={class:"text-right"},yt={class:"col-12 col-md-5"},wt={class:"div"},Ct={class:"text-h6 row items-center"},kt={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},Qt=["onUpdate:modelValue"],Pt=["onUpdate:modelValue"],Tt={class:"text-right"},$t={class:"text-bold text-right"},St={class:"row"},zt={class:"col-12 q-pa-xs"},Bt={class:"row"},Dt={class:"col-8"},qt={class:"col-2 flex flex-center"},Nt={class:"col-2 flex flex-center"},Ut={class:"col-12"},Ft={class:"col-12"},Et={class:"text-right"},It={class:"text-right"},Mt={class:"text-bold text-right"},At={class:"col-12 q-pa-xs"},Rt={key:0,class:"col-12"},Lt={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},al={__name:"VentaAdd",setup(Ht){const O=lt(),{proxy:u}=et(),k=i({nombre:"",fecha:new Date().toISOString().slice(0,10)}),q=i([]);i([]);const c=i([]);let g=i("");const V=i(!1),p=i(!1),Q=i(1),P=i(1),_=i("Todos"),G=["Todos","Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],y=i([]),T=i([]),v=i(null);ot(()=>{$(),W()});function W(){u.$axios.get("mascotas",{params:{filter:""}}).then(a=>{y.value=a.data.data})}function Z(){console.log(v.value),p.value=!0,u.$axios.post("mascotas/historial",{mascotaId:v.value.id}).then(a=>{console.log(a.data),T.value=a.data}).finally(()=>{p.value=!1})}function N(a){switch(a){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function $(){u.$axios.get("/productos",{params:{filter:g.value,page:Q.value,limit:20,tipo:_.value==="Todos"?"":_.value}}).then(a=>{q.value=a.data.data,P.value=a.data.last_page})}const S=at(()=>c.value.reduce((a,e)=>a+e.cantidadVenta*e.precioVenta,0).toFixed(2));function j(a){const e=c.value.find(l=>l.id===a.id);e?e.cantidadVenta++:c.value.push({...a,cantidadVenta:1,precioVenta:a.precioVenta})}function J(a){c.value.splice(a,1)}function K(){if(c.value.length===0){u.$alert.error("El carrito está vacío","Error");return}V.value=!0,v.value={id:1,nombre:"SN",propietario_nombre:"SN"}}function X(a,e){if(a===""){e(()=>{u.$axios.get("mascotas",{params:{filter:""}}).then(l=>{y.value=l.data.data})});return}e(()=>{u.$axios.get("mascotas",{params:{filter:a}}).then(l=>{y.value=l.data.data})})}function Y(){if(c.value.length===0){u.$alert.error("El carrito está vacío");return}p.value=!0,u.$axios.post("/sales",{mascota:v.value,total:parseFloat(S.value),productos:c.value,comentarioDoctor:k.value.comentarioDoctor}).then(async a=>{u.$alert.success("Venta realizada con éxito","Éxito"),O.push("/ventas"),ut.nota(a.data.sale)}).catch(a=>{u.$alert.error(a.response.data.message,"Error")}).finally(()=>{p.value=!1})}return(a,e)=>(r(),d(x,null,[o(dt,{class:"q-pa-xs"},{default:s(()=>[t("div",ct,[t("div",pt,[o(m,{label:"Atras",color:"primary",onClick:e[0]||(e[0]=l=>a.$router.push("/ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),t("div",mt,[o(z,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[o(w,null,{default:s(()=>[o(L,{onSubmit:U($,["prevent"])},{default:s(()=>[t("div",vt,[t("div",ft,[o(F,{modelValue:st(g),"onUpdate:modelValue":e[1]||(e[1]=l=>nt(g)?g.value=l:g=l),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),t("div",bt,[o(A,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),label:"Tipo",outlined:"",dense:"",options:G},null,8,["modelValue"])]),t("div",xt,[o(m,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),t("div",gt,[t("div",ht,[P.value>1?(r(),E(it,{key:0,modelValue:Q.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>Q.value=l),$],max:P.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):B("",!0)])]),o(C,{dense:"",bordered:"",flat:""},{default:s(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Cod"),t("th",null,"Nombre"),t("th",null,"Tipo"),t("th",null,"Precio"),t("th",null,"Stock")])],-1)),t("tbody",null,[(r(!0),d(x,null,h(q.value,l=>(r(),d("tr",{onClick:f=>j(l),key:l.id,style:{cursor:"pointer"}},[t("td",null,n(l.codigo),1),t("td",null,n(l.nombre),1),t("td",null,[o(R,{dense:"",color:N(l.tipo),size:"10px"},{default:s(()=>[D(n(l.tipo),1)]),_:2},1032,["color"])]),t("td",_t,n(l.precioVenta),1),t("td",null,n(l.stock),1)],8,Vt))),128))])]),_:1})]),_:1})]),_:1})]),t("div",yt,[o(z,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[o(w,null,{default:s(()=>[t("div",wt,[t("div",Ct,[e[10]||(e[10]=t("div",null,"Carrito",-1)),o(H),o(m,{icon:"delete",color:"red",dense:"",onClick:e[4]||(e[4]=l=>c.value=[]),loading:p.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),e[11]||(e[11]=t("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),o(C,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[e[14]||(e[14]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Precio"),t("th",null,"Subtotal"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(r(!0),d(x,null,h(c.value,(l,f)=>(r(),d("tr",{key:f},[t("td",null,[t("div",kt,n(l.nombre),1)]),t("td",null,[I(t("input",{"onUpdate:modelValue":b=>l.cantidadVenta=b,type:"number",style:{width:"50px"},min:"1"},null,8,Qt),[[M,l.cantidadVenta,void 0,{number:!0}]])]),t("td",null,[I(t("input",{"onUpdate:modelValue":b=>l.precioVenta=b,type:"number",style:{width:"80px"},min:"1",step:"0.1"},null,8,Pt),[[M,l.precioVenta,void 0,{number:!0}]])]),t("td",Tt,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1),t("td",null,[o(m,{icon:"delete",color:"red",dense:"",onClick:b=>J(f),loading:p.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),t("tfoot",null,[t("tr",null,[e[12]||(e[12]=t("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),t("td",$t,n(S.value)+" Bs",1),e[13]||(e[13]=t("td",null,null,-1))])])]),_:1}),o(m,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:K,loading:p.value},null,8,["loading"])]),_:1})]),_:1})])]),o(rt,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=l=>V.value=l)},{default:s(()=>[o(z,{flat:"",bordered:"",style:{"max-width":"750px"}},{default:s(()=>[o(w,{class:"q-pb-none row items-center"},{default:s(()=>[e[15]||(e[15]=t("div",{class:"text-bold"}," Realizar Venta ",-1)),o(H),o(m,{flat:"",dense:"",round:"",icon:"close",onClick:e[5]||(e[5]=l=>V.value=!1)})]),_:1}),o(w,null,{default:s(()=>[o(L,{onSubmit:U(Y,["prevent"])},{default:s(()=>[t("div",St,[t("div",zt,[t("div",Bt,[t("div",Dt,[o(A,{"input-debounce":"300",clearable:"","use-input":"",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),label:"Mascota",outlined:"",dense:"",options:y.value,"option-label":l=>l.id+"|"+l.nombre+"|"+l.propietario_nombre,"option-value":l=>l.id,onFilter:X,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","option-label","option-value","rules"])]),t("div",qt,[o(m,{loading:p.value,dense:"",color:"green",label:"Crear","no-caps":"",icon:"add_circle_outline",to:"/mascotas/create"},null,8,["loading"])]),t("div",Nt,[v.value?(r(),E(m,{key:0,loading:p.value,dense:"",color:"blue",label:"historial","no-caps":"",icon:"history",onClick:Z},null,8,["loading"])):B("",!0)])])]),t("div",Ut,[o(F,{modelValue:k.value.comentarioDoctor,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value.comentarioDoctor=l),label:"Comentario Doctor",outlined:"",dense:"",type:"textarea",rows:"2"},null,8,["modelValue"])]),t("div",Ft,[o(C,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[e[17]||(e[17]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Producto"),t("th",null,"Cantidad"),t("th",null,"Tipo"),t("th",null,"Precio"),t("th",null,"Subtotal")])],-1)),t("tbody",null,[(r(!0),d(x,null,h(c.value,(l,f)=>(r(),d("tr",{key:f},[t("td",null,n(l.nombre),1),t("td",null,n(l.cantidadVenta),1),t("td",null,[o(R,{dense:"",color:N(l.tipo),size:"10px"},{default:s(()=>[D(n(l.tipo),1)]),_:2},1032,["color"])]),t("td",Et,n(l.precioVenta)+" Bs",1),t("td",It,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1)]))),128))]),t("tfoot",null,[t("tr",null,[e[16]||(e[16]=t("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),t("td",Mt,n(S.value)+" Bs",1)])])]),_:1})]),t("div",At,[o(m,{label:"Realizar Venta",color:"positive",class:"full-width",type:"submit","no-caps":"",loading:p.value},null,8,["loading"])]),T.value.length>0?(r(),d("div",Rt,[e[20]||(e[20]=t("div",{class:"text-h6 row items-center"}," Historial de Compras ",-1)),o(C,{flat:"",bordered:"",dense:""},{default:s(()=>[e[19]||(e[19]=t("thead",null,[t("tr",null,[t("td",null,"#"),t("td",null,"Fecha"),t("td",null,"Total"),t("td",null,"Anulado"),t("td",null,"Detalles")])],-1)),t("tbody",null,[(r(!0),d(x,null,h(T.value,(l,f)=>(r(),d("tr",{key:f},[t("td",null,n(l.id),1),t("td",null,n(l.fecha.slice(0,10)),1),t("td",null,n(l.total),1),t("td",null,n(l.anulado?"Si":"No"),1),t("td",null,[t("div",Lt,[(r(!0),d(x,null,h(l.details,(b,tt)=>(r(),d("span",{key:tt},[D(n(b.productoName)+" ("+n(b.cantidad)+")",1),e[18]||(e[18]=t("br",null,null,-1))]))),128))])])]))),128))])]),_:1})])):B("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e[21]||(e[21]=t("div",{id:"myElement"},null,-1))],64))}};export{al as default};

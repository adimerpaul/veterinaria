import{aK as j,g as H,r,V as J,k as X,c as B,o as u,w as s,b as e,a,f as c,Q,e as _,ao as q,ak as Y,aL as ee,u as te,al as le,a0 as m,a1 as P,a2 as T,t as n,Z as U,W as F,aM as N,h as ae}from"./index-Bxzzzh3w.js";import{Q as M,b as D}from"./QSelect-CFRO6gX4.js";import{Q as E}from"./QForm-CiqTuq1d.js";import{Q as oe}from"./QPagination-B5Fg2aVG.js";import{Q as $}from"./QMarkupTable-Bsdy-APE.js";import{Q as L}from"./QSpace-Bmcwb303.js";import{Q as se}from"./QPage-DrPVOnkl.js";import"./format-BowtMuZ1.js";import"./QItemLabel-DOqrTAYA.js";const ne={class:"row"},re={class:"col-12"},ie={class:"col-12 col-md-7"},de={class:"row"},ue={class:"col-12 col-md-7"},ce={class:"col-12 col-md-3"},pe={class:"col-12 col-md-2 flex flex-center"},me={class:"row"},ve={class:"col-12 flex flex-center"},fe=["onClick"],be={class:"text-right"},ge={class:"col-12 col-md-5"},xe={class:"div"},Ve={class:"text-h6 row items-center"},he={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},_e=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],we={class:"text-right"},Ce={class:"text-bold text-right"},ke={class:"row"},Qe={class:"col-12 q-pa-xs"},Pe={class:"col-12"},Te={class:"text-right"},$e={class:"text-right"},Se={class:"text-bold text-right"},ze={class:"col-12 q-pa-xs"},Ae={__name:"VentaAdd",setup(Be){const R=j(),{proxy:d}=H();r({nombre:"",fecha:new Date().toISOString().slice(0,10)});const S=r([]);r([]);const i=r([]);let v=r("");const b=r(!1),p=r(!1),y=r(1),w=r(1),g=r("Todos"),A=["Todos","Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],x=r([]),V=r(null);J(()=>{C(),I()});function I(){d.$axios.get("mascotas",{params:{filter:""}}).then(o=>{x.value=o.data.data})}function z(o){switch(o){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function C(){d.$axios.get("/productos",{params:{filter:v.value,page:y.value,limit:20,tipo:g.value==="Todos"?"":g.value}}).then(o=>{S.value=o.data.data,w.value=o.data.last_page})}const k=X(()=>i.value.reduce((o,l)=>o+l.cantidadVenta*l.precioVenta,0).toFixed(2));function G(o){const l=i.value.find(t=>t.id===o.id);l?l.cantidadVenta++:i.value.push({...o,cantidadVenta:1,precioVenta:o.precioVenta})}function K(o){i.value.splice(o,1)}function O(){if(i.value.length===0){d.$alert.error("El carrito está vacío","Error");return}b.value=!0,V.value={id:1,nombre:"SN",propietario_nombre:"SN"}}function W(o,l){if(o===""){l(()=>{d.$axios.get("mascotas",{params:{filter:""}}).then(t=>{x.value=t.data.data})});return}l(()=>{d.$axios.get("mascotas",{params:{filter:o}}).then(t=>{x.value=t.data.data})})}function Z(){if(i.value.length===0){d.$alert.error("El carrito está vacío");return}p.value=!0,d.$axios.post("/sales",{mascota:V.value,total:k.value,productos:i.value}).then(async()=>{d.$alert.success("Venta realizada con éxito","Éxito"),R.push("/ventas")}).catch(o=>{d.$alert.error(o.response.data.message,"Error")}).finally(()=>{p.value=!1})}return(o,l)=>(u(),B(se,{class:"q-pa-xs"},{default:s(()=>[e("div",ne,[e("div",re,[a(c,{label:"Atras",color:"primary",onClick:l[0]||(l[0]=t=>o.$router.push("/ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),e("div",ie,[a(Q,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[a(_,null,{default:s(()=>[a(E,{onSubmit:q(C,["prevent"])},{default:s(()=>[e("div",de,[e("div",ue,[a(Y,{modelValue:te(v),"onUpdate:modelValue":l[1]||(l[1]=t=>ee(v)?v.value=t:v=t),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",ce,[a(M,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=t=>g.value=t),label:"Tipo",outlined:"",dense:"",options:A},null,8,["modelValue"])]),e("div",pe,[a(c,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),e("div",me,[e("div",ve,[w.value>1?(u(),B(oe,{key:0,modelValue:y.value,"onUpdate:modelValue":[l[3]||(l[3]=t=>y.value=t),C],max:w.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):le("",!0)])]),a($,{dense:"",bordered:"",flat:""},{default:s(()=>[l[8]||(l[8]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Stock")])],-1)),e("tbody",null,[(u(!0),m(P,null,T(S.value,t=>(u(),m("tr",{onClick:f=>G(t),key:t.id,style:{cursor:"pointer"}},[e("td",null,n(t.codigo),1),e("td",null,n(t.nombre),1),e("td",null,[a(D,{dense:"",color:z(t.tipo),size:"10px"},{default:s(()=>[U(n(t.tipo),1)]),_:2},1032,["color"])]),e("td",be,n(t.precioVenta),1),e("td",null,n(t.stock),1)],8,fe))),128))])]),_:1})]),_:1})]),_:1})]),e("div",ge,[a(Q,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[a(_,null,{default:s(()=>[e("div",xe,[e("div",Ve,[l[9]||(l[9]=e("div",null,"Carrito",-1)),a(L),a(c,{icon:"delete",color:"red",dense:"",onClick:l[4]||(l[4]=t=>i.value=[]),loading:p.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),l[10]||(l[10]=e("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),a($,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[l[13]||(l[13]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(u(!0),m(P,null,T(i.value,(t,f)=>(u(),m("tr",{key:f},[e("td",null,[e("div",he,n(t.nombre),1)]),e("td",null,[F(e("input",{"onUpdate:modelValue":h=>t.cantidadVenta=h,type:"number",style:{width:"50px"},min:"1"},null,8,_e),[[N,t.cantidadVenta,void 0,{number:!0}]])]),e("td",null,[F(e("input",{"onUpdate:modelValue":h=>t.precioVenta=h,type:"number",style:{width:"80px"},min:"1",step:"0.1"},null,8,ye),[[N,t.precioVenta,void 0,{number:!0}]])]),e("td",we,n((t.cantidadVenta*t.precioVenta).toFixed(2))+" Bs",1),e("td",null,[a(c,{icon:"delete",color:"red",dense:"",onClick:h=>K(f),loading:p.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),e("tfoot",null,[e("tr",null,[l[11]||(l[11]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Ce,n(k.value)+" Bs",1),l[12]||(l[12]=e("td",null,null,-1))])])]),_:1}),a(c,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:O,loading:p.value},null,8,["loading"])]),_:1})]),_:1})])]),a(ae,{modelValue:b.value,"onUpdate:modelValue":l[7]||(l[7]=t=>b.value=t)},{default:s(()=>[a(Q,{flat:"",bordered:"",style:{"min-width":"350px"}},{default:s(()=>[a(_,{class:"q-pb-none row items-center"},{default:s(()=>[l[14]||(l[14]=e("div",{class:"text-bold"}," Realizar Venta ",-1)),a(L),a(c,{flat:"",dense:"",round:"",icon:"close",onClick:l[5]||(l[5]=t=>b.value=!1)})]),_:1}),a(_,null,{default:s(()=>[a(E,{onSubmit:q(Z,["prevent"])},{default:s(()=>[e("div",ke,[e("div",Qe,[a(M,{"input-debounce":"300",clearable:"","use-input":"",modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=t=>V.value=t),label:"Mascota",outlined:"",dense:"",options:x.value,"option-label":t=>t.id+"|"+t.nombre+"|"+t.propietario_nombre,"option-value":t=>t.id,onFilter:W,rules:[t=>!!t||"Campo requerido"]},{after:s(()=>[a(c,{dense:"",color:"green",label:"Crear mascota","no-caps":"",icon:"add_circle_outline",to:"/mascotas/create"})]),_:1},8,["modelValue","options","option-label","option-value","rules"])]),e("div",Pe,[a($,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[l[16]||(l[16]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(u(!0),m(P,null,T(i.value,(t,f)=>(u(),m("tr",{key:f},[e("td",null,n(t.nombre),1),e("td",null,n(t.cantidadVenta),1),e("td",null,[a(D,{dense:"",color:z(t.tipo),size:"10px"},{default:s(()=>[U(n(t.tipo),1)]),_:2},1032,["color"])]),e("td",Te,n(t.precioVenta)+" Bs",1),e("td",$e,n((t.cantidadVenta*t.precioVenta).toFixed(2))+" Bs",1)]))),128))]),e("tfoot",null,[e("tr",null,[l[15]||(l[15]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Se,n(k.value)+" Bs",1)])])]),_:1})]),e("div",ze,[a(c,{label:"Realizar Venta",color:"positive",class:"full-width",type:"submit","no-caps":"",loading:p.value},null,8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ae as default};

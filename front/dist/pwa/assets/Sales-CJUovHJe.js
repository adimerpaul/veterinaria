import{g as W,r as d,V as Z,a0 as c,o as s,a as l,b as o,w as t,Q as q,e as $,aq as N,an as h,c as v,a1 as C,f as V,W as w,$ as y,t as i,Z as b,_ as k,a2 as B,a3 as T,a8 as G,h as K}from"./index-FikdBdHy.js";import{Q as X}from"./QSelect-jHfDKU4Z.js";import{Q as j}from"./QForm-YbfXjnEs.js";import{Q,a as u}from"./QMenu-DkGfLhD3.js";import{Q as p}from"./QItemLabel-B1GWS49b.js";import{a as F,Q as ee}from"./QList-7unTwnYh.js";import{Q as le}from"./QChip-YaYu8USA.js";import{Q as ae}from"./QMarkupTable-CFAusM7c.js";import{Q as oe}from"./QPage-CI2hWckP.js";import{Q as te}from"./QSpace-DtWpNYpy.js";import{C as L}from"./ClosePopup-B7E_R8dN.js";import{h as E}from"./moment-C5S46NFB.js";import"./numeroaletras-C3tYt5BD.js";import{I as ne}from"./Imprimir-UsvcAq5m.js";import{E as se}from"./Excel-CKQ98bqC.js";import"./format-DyQxkAtJ.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const de={class:"row"},ie={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ue={class:"col-12 col-md-2"},me={class:"col-12 col-md-2 flex flex-center"},ce={class:"col-12 col-md-2 flex flex-center"},fe={class:"col-12 col-md-4"},pe={class:"col-12 col-md-2 flex flex-center"},ve={class:"row"},be={key:0,class:"col-12 col-md-4 q-pa-xs"},xe={class:"text-weight-bold"},_e={key:1,class:"col-12 col-md-4 q-pa-xs"},ge={class:"text-weight-bold"},he={key:2,class:"col-12 col-md-4 q-pa-xs"},Ce={class:"text-weight-bold"},Ve={key:1},we={class:"text-right"},ye={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},ke={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},He={__name:"Sales",setup(Qe){const{proxy:x}=W(),A=d(E().format("YYYY-MM-DD")),Y=d(E().format("YYYY-MM-DD")),f=d([]),S=d([]),r=d(!1),_=d(""),U=d([]),I=d("");d("CAJA");const D=d(!1),g=d({});d([]),d(["CAJA","PRODUCTOS"]),Z(()=>{M(),z()});function O(){r.value=!0,x.$axios.post("/cajas",g.value).then(n=>{D.value=!1,x.$alert.success("Registrado correctamente",n.data)}).finally(()=>{r.value=!1})}function P(){if(!_.value){f.value=S.value;return}f.value=S.value.filter(n=>n.nombre.toLowerCase().includes(_.value.toLowerCase())||n.user?.name.toLowerCase().includes(_.value.toLowerCase()))}function H(n){ne.nota(n)}function R(){const n=[{sheet:"Ventas",columns:[{label:"Fecha",value:e=>E(e.fecha).format("DD/MM/YYYY HH:mm")},{label:"Cliente",value:e=>e.nombre},{label:"Mascota",value:e=>e.mascota?.nombre},{label:"Usuario",value:e=>e.user?.username},{label:"Total",value:e=>e.total},{label:"Comentario Doctor",value:e=>e.comentarioDoctor},{label:"Detalles",value:e=>e.details.map(a=>`${a.cantidad} ${a.productoName}`).join(", ")}],content:f.value.map(e=>({fecha:e.fecha,nombre:e.nombre,mascota:e.mascota,user:e.user,total:e.total,comentarioDoctor:e.comentarioDoctor,details:e.details}))}];se.export(n,"Ventas")}function J(n){x.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{r.value=!0,x.$axios.put(`/sales/${n}/anular`).then(()=>{M()}).finally(()=>{r.value=!1})})}function z(){U.value=[{id:"",name:"Todos"}],x.$axios.get("/users").then(n=>{n.data.forEach(e=>{U.value.push({id:e.id,name:e.name})})})}function M(){r.value=!0,x.$axios.get("/sales",{params:{fechaInicio:A.value,fechaFin:Y.value,user_id:I.value}}).then(n=>{f.value=n.data,S.value=n.data}).finally(()=>{r.value=!1})}return(n,e)=>(s(),c(B,null,[l(oe,{class:"q-pa-xs"},{default:t(()=>[l(q,{flat:"",bordered:""},{default:t(()=>[l($,{class:"q-pa-xs"},{default:t(()=>[l(j,{onSubmit:N(M,["prevent"])},{default:t(()=>[o("div",de,[o("div",ie,[l(h,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",re,[l(h,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>Y.value=a),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",ue,[n.$store.user.role==="Admin"?(s(),v(X,{key:0,modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=a=>I.value=a),label:"Usuario",outlined:"",dense:"",options:U.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):C("",!0)]),o("div",me,[l(V,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:r.value},null,8,["loading"])]),e[9]||(e[9]=o("div",{class:"col-12 col-md-2"},null,-1)),o("div",ce,[l(V,{label:"Excel",color:"green",icon:"fa-solid fa-file-excel","no-caps":"",loading:r.value,onClick:R},null,8,["loading"])]),e[10]||(e[10]=o("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),o("div",fe,[l(h,{modelValue:_.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>_.value=a),P],label:"Filtro",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),o("div",pe,[l(V,{style:{width:"150px"},label:"Venta",color:"positive",onClick:e[4]||(e[4]=a=>n.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:r.value},null,8,["loading"])]),e[11]||(e[11]=o("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),e[12]||(e[12]=o("div",{class:"col-12 col-md-2 flex flex-center"},null,-1))])]),_:1}),o("div",ve,[n.$store.user.role==="Admin"?(s(),c("div",be,[l(F,{bordered:"",padding:"",dense:""},{default:t(()=>[w((s(),v(Q,{clickable:""},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(y,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(u,null,{default:t(()=>[l(p,{lines:"1"},{default:t(()=>[o("span",xe,i(f.value.length)+" ventas ",1)]),_:1}),l(p,{caption:"",lines:"2"},{default:t(()=>e[13]||(e[13]=[b(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):C("",!0),n.$store.user.role==="Admin"?(s(),c("div",_e,[l(F,{bordered:"",padding:"",dense:""},{default:t(()=>[w((s(),v(Q,{clickable:""},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(y,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(u,null,{default:t(()=>[l(p,{lines:"1"},{default:t(()=>[o("span",ge," Bs "+i(f.value.filter(a=>!a.anulado).reduce((a,m)=>a+parseFloat(m.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:t(()=>e[14]||(e[14]=[b(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):C("",!0),n.$store.user.role==="Admin"?(s(),c("div",he,[l(F,{bordered:"",padding:"",dense:""},{default:t(()=>[w((s(),v(Q,{clickable:""},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(y,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(u,null,{default:t(()=>[l(p,{lines:"1"},{default:t(()=>[o("span",Ce," Bs "+i(f.value.filter(a=>a.anulado).reduce((a,m)=>a+parseFloat(m.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:t(()=>e[15]||(e[15]=[b(" Total de ventas anuladas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):C("",!0)])]),_:1})]),_:1}),l(q,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[l($,null,{default:t(()=>[l(ae,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[e[19]||(e[19]=o("thead",null,[o("tr",{class:"bg-orange text-white"},[o("th",null,"Acciones"),o("th",null,"Fecha"),o("th",null,"Total"),o("th",null,"Nombre Cliente"),o("th",null,"Usuario"),o("th",null,"Detalle"),o("th",null,"Comentario Doctor"),o("th",null,"Pago")])],-1)),o("tbody",null,[(s(!0),c(B,null,T(f.value,a=>(s(),c("tr",{key:a.id},[o("td",null,[a.anulado?(s(),c("div",Ve,[l(le,{color:"red","text-color":"white",label:"Anulada"})])):(s(),v(ee,{key:0,label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"indigo",size:"10px"},{default:t(()=>[l(F,null,{default:t(()=>[w((s(),v(Q,{clickable:"",onClick:m=>H(a)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(y,{icon:"print"})]),_:1}),l(u,null,{default:t(()=>[l(p,null,{default:t(()=>e[16]||(e[16]=[b("Imprimir")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k],[L]]),l(G),a.anulado?C("",!0):w((s(),v(Q,{key:0,clickable:"",onClick:m=>J(a.id)},{default:t(()=>[l(u,{avatar:""},{default:t(()=>[l(y,{icon:"delete"})]),_:1}),l(u,null,{default:t(()=>[l(p,null,{default:t(()=>e[17]||(e[17]=[b("Anular")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k],[L]])]),_:2},1024)]),_:2},1024))]),o("td",null,i(n.$filters.dateDmYHis(a.fecha)),1),o("td",we,i(a.total),1),o("td",null,[b(i(a.nombre)+" ",1),e[18]||(e[18]=o("br",null,null,-1)),b(" "+i(a.mascota?.nombre),1)]),o("td",null,i(a.user?.username),1),o("td",null,[o("div",ye,[(s(!0),c(B,null,T(a.details,m=>(s(),c("span",{key:m.id},i(m.cantidad)+" "+i(m.productoName)+", ",1))),128))])]),o("td",null,[o("div",ke,i(a.comentarioDoctor),1)]),o("td",null,i(a.pago),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(K,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=a=>D.value=a),persistent:""},{default:t(()=>[l(q,{flat:"",bordered:"",style:{width:"350px"}},{default:t(()=>[l($,{class:"row items-center q-pb-none"},{default:t(()=>[e[20]||(e[20]=o("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(te),l(V,{flat:"",dense:"",icon:"close",onClick:e[5]||(e[5]=a=>D.value=!1)})]),_:1}),l($,null,{default:t(()=>[l(j,{onSubmit:N(O,["prevent"])},{default:t(()=>[l(h,{modelValue:g.value.monto_final,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value.monto_final=a),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(h,{type:"textarea",modelValue:g.value.observacion,"onUpdate:modelValue":e[7]||(e[7]=a=>g.value.observacion=a),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(V,{label:"Cerrar Caja",color:"red",type:"submit",loading:r.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[21]||(e[21]=o("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{He as default};

import{g as ee,r as i,a1 as le,a7 as f,o as d,a as l,b as o,w as t,Q as E,e as I,aw as B,at as w,c as V,a8 as g,f as x,a6 as k,a4 as v,t as u,a9 as N,aa as j,J as L,a5 as O,I as ae,h as te}from"./index-CeLS1kfd.js";import{Q as oe}from"./QSelect-Cr40Q5mg.js";import{Q as P}from"./QForm-B0DFzUrN.js";import{Q as D,a as c}from"./QMenu-BNcm7Ouo.js";import{Q as b}from"./QItemLabel-B5ElpcAC.js";import{a as S,Q as ne}from"./QList-Cy9RETy4.js";import{Q as se}from"./QChip-BQ60xaLu.js";import{Q as re}from"./QMarkupTable-BZbS-C9N.js";import{Q as de}from"./QPage-g5g7VCmC.js";import{Q as ie}from"./QSpace-D-MpJVm-.js";import{C as R}from"./ClosePopup-CpQ_cBxn.js";import{h as _}from"./moment-C5S46NFB.js";import{p as ue}from"./index-ByRWkf4M.js";import{I as me}from"./Imprimir-j96HB3l0.js";import{E as ce}from"./Excel-CKQ98bqC.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./format-DyQxkAtJ.js";import"./numeroaletras-B5rgbfjP.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const fe={class:"row"},ve={class:"col-12 col-md-2"},be={class:"col-12 col-md-2"},he={class:"col-12 col-md-2"},ge={class:"col-12 col-md-2 flex flex-center"},xe={class:"col-12 col-md-2 flex flex-center"},_e={class:"col-12 col-md-2 flex flex-center"},ye={class:"col-12 col-md-4 q-mt-sm"},Ce={class:"col-12 col-md-2 flex flex-center q-mt-sm"},$e={class:"row q-mt-sm"},we={key:0,class:"col-12 col-md-4 q-pa-xs"},Ve={key:1,class:"col-12 col-md-4 q-pa-xs"},ke={key:2,class:"col-12 col-md-4 q-pa-xs"},De={key:1},Qe={class:"text-right"},Ye={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},Ae={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},Fe={__name:"Sales",setup(Me){const{proxy:h}=ee(),Q=i(_().format("YYYY-MM-DD")),Y=i(_().format("YYYY-MM-DD")),p=i([]),T=i([]),m=i(!1),y=i(""),A=i([]),C=i("");i("CAJA");const F=i(!1),$=i({});i([]),i(["CAJA","PRODUCTOS"]),le(()=>{U(),X()});function H(){m.value=!0,h.$axios.post("/cajas",$.value).then(n=>{F.value=!1,h.$alert.success("Registrado correctamente",n.data)}).finally(()=>{m.value=!1})}function z(){if(!y.value){p.value=T.value;return}p.value=T.value.filter(n=>(n.nombre||"").toLowerCase().includes(y.value.toLowerCase())||(n.user?.name||"").toLowerCase().includes(y.value.toLowerCase()))}function J(n){me.nota(n)}function G(){const n=p.value.filter(e=>!e.anulado),a=[{sheet:"Ventas",columns:[{label:"Fecha",value:e=>_(e.fecha).format("DD/MM/YYYY HH:mm")},{label:"Cliente",value:e=>e.nombre},{label:"Mascota",value:e=>e.mascota?.nombre||""},{label:"Usuario",value:e=>e.user?.username||""},{label:"Total",value:e=>e.total},{label:"Comentario Doctor",value:e=>e.comentarioDoctor||""},{label:"Detalles",value:e=>(e.details||[]).map(r=>`${r.cantidad} ${r.productoName}`).join(", ")}],content:n.map(e=>({fecha:e.fecha,nombre:e.nombre,mascota:e.mascota,user:e.user,total:e.total,comentarioDoctor:e.comentarioDoctor,details:e.details}))}];ce.export(a,"Ventas")}function K(){const n=new ue.Printd,a=p.value.filter(s=>!s.anulado),e=a.reduce((s,M)=>s+parseFloat(M.total||0),0),r=`
    <style>
      * { box-sizing: border-box; }
      body { font-family: Arial, sans-serif; font-size: 12px; margin: 16px; }
      h3 { margin: 0 0 10px 0; }
      .meta { margin-bottom: 10px; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1px solid #000; padding: 4px; vertical-align: top; }
      thead tr { background: #e65100; color: #fff; }
      tfoot tr { background: #eee; font-weight: bold; }
      .right { text-align: right; }
      .small { font-size: 11px; }
      @media print { @page { size: A4 portrait; margin: 12mm; } }
    </style>
  `,Z=`
    <div>
      <h3>REPORTE DE VENTAS</h3>
      <div class="meta small">
        Rango: ${_(Q.value).format("DD/MM/YYYY")} - ${_(Y.value).format("DD/MM/YYYY")}
        ${C.value?` | Usuario: ${(A.value.find(s=>s.id===C.value)||{}).name||""}`:""}
      </div>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Usuario</th>
            <th>Detalle</th>
            <th class="right">Total (Bs)</th>
            <th>Pago</th>
            <th>Comentario</th>
          </tr>
        </thead>
        <tbody>
          ${a.map(s=>`
              <tr>
                <td>${_(s.fecha).format("DD/MM/YYYY HH:mm")}</td>
                <td>${s.nombre||""}${s.mascota?.nombre?" / "+s.mascota.nombre:""}</td>
                <td>${s.user?.username||""}</td>
                <td class="small">
                  ${(s.details||[]).map(M=>`${M.cantidad} ${M.productoName}`).join(", ")}
                </td>
                <td class="right">${Number(s.total||0).toFixed(2)}</td>
                <td>${s.pago||""}</td>
                <td class="small">${s.comentarioDoctor||""}</td>
              </tr>
            `).join("")}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" class="right">TOTAL</td>
            <td class="right">${e.toFixed(2)}</td>
            <td colspan="2"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  `,q=document.getElementById("printArea");q.innerHTML=Z,n.print(q,[r])}function W(n){h.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{m.value=!0,h.$axios.put(`/sales/${n}/anular`).then(()=>{U()}).finally(()=>{m.value=!1})})}function X(){A.value=[{id:"",name:"Todos"}],h.$axios.get("/users").then(n=>{n.data.forEach(a=>{A.value.push({id:a.id,name:a.name})})})}function U(){m.value=!0,h.$axios.get("/sales",{params:{fechaInicio:Q.value,fechaFin:Y.value,user_id:C.value}}).then(n=>{p.value=n.data,T.value=n.data}).finally(()=>{m.value=!1})}return(n,a)=>(d(),f(N,null,[l(de,{class:"q-pa-xs"},{default:t(()=>[l(E,{flat:"",bordered:""},{default:t(()=>[l(I,{class:"q-pa-xs"},{default:t(()=>[l(P,{onSubmit:B(U,["prevent"])},{default:t(()=>[o("div",fe,[o("div",ve,[l(w,{modelValue:Q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value=e),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",be,[l(w,{modelValue:Y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value=e),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",he,[n.$store.user.role==="Admin"?(d(),V(oe,{key:0,modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value=e),label:"Usuario",outlined:"",dense:"",options:A.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):g("",!0)]),o("div",ge,[l(x,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:m.value},null,8,["loading"])]),o("div",xe,[n.$store.user.role==="Admin"?(d(),V(x,{key:0,style:{width:"150px"},label:"Imprimir",color:"indigo",icon:"print","no-caps":"",loading:m.value,onClick:K},null,8,["loading"])):g("",!0)]),o("div",_e,[l(x,{label:"Excel",color:"green",icon:"fa-solid fa-file-excel","no-caps":"",loading:m.value,onClick:G},null,8,["loading"])]),o("div",ye,[l(w,{modelValue:y.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>y.value=e),z],label:"Filtro",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),o("div",Ce,[l(x,{style:{width:"150px"},label:"Venta",color:"positive",onClick:a[4]||(a[4]=e=>n.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:m.value},null,8,["loading"])])])]),_:1}),o("div",$e,[n.$store.user.role==="Admin"?(d(),f("div",we,[l(S,{bordered:"",padding:"",dense:""},{default:t(()=>[l(D,null,{default:t(()=>[l(c,{avatar:""},{default:t(()=>[l(k,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(c,null,{default:t(()=>[l(b,null,{default:t(()=>[o("b",null,u(p.value.length),1),a[9]||(a[9]=v(" ventas"))]),_:1}),l(b,{caption:""},{default:t(()=>a[10]||(a[10]=[v("Cantidad de ventas")])),_:1})]),_:1})]),_:1})]),_:1})])):g("",!0),n.$store.user.role==="Admin"?(d(),f("div",Ve,[l(S,{bordered:"",padding:"",dense:""},{default:t(()=>[l(D,null,{default:t(()=>[l(c,{avatar:""},{default:t(()=>[l(k,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(c,null,{default:t(()=>[l(b,null,{default:t(()=>[o("b",null,"Bs "+u(p.value.filter(e=>!e.anulado).reduce((e,r)=>e+parseFloat(r.total),0).toFixed(2)),1)]),_:1}),l(b,{caption:""},{default:t(()=>a[11]||(a[11]=[v("Total de ventas (vigentes)")])),_:1})]),_:1})]),_:1})]),_:1})])):g("",!0),n.$store.user.role==="Admin"?(d(),f("div",ke,[l(S,{bordered:"",padding:"",dense:""},{default:t(()=>[l(D,null,{default:t(()=>[l(c,{avatar:""},{default:t(()=>[l(k,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(c,null,{default:t(()=>[l(b,null,{default:t(()=>[o("b",null,"Bs "+u(p.value.filter(e=>e.anulado).reduce((e,r)=>e+parseFloat(r.total),0).toFixed(2)),1)]),_:1}),l(b,{caption:""},{default:t(()=>a[12]||(a[12]=[v("Total de ventas anuladas")])),_:1})]),_:1})]),_:1})]),_:1})])):g("",!0)])]),_:1})]),_:1}),l(E,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[l(I,null,{default:t(()=>[l(re,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[a[16]||(a[16]=o("thead",null,[o("tr",{class:"bg-orange text-white"},[o("th",null,"Acciones"),o("th",null,"Fecha"),o("th",null,"Total"),o("th",null,"Nombre Cliente"),o("th",null,"Usuario"),o("th",null,"Detalle"),o("th",null,"Comentario Doctor"),o("th",null,"Pago")])],-1)),o("tbody",null,[(d(!0),f(N,null,j(p.value,e=>(d(),f("tr",{key:e.id},[o("td",null,[e.anulado?(d(),f("div",De,[l(se,{color:"red","text-color":"white",label:"Anulada"})])):(d(),V(ne,{key:0,label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"indigo",size:"10px"},{default:t(()=>[l(S,null,{default:t(()=>[L((d(),V(D,{clickable:"",onClick:r=>J(e)},{default:t(()=>[l(c,{avatar:""},{default:t(()=>[l(k,{icon:"print"})]),_:1}),l(c,null,{default:t(()=>[l(b,null,{default:t(()=>a[13]||(a[13]=[v("Imprimir")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[O],[R]]),l(ae),e.anulado?g("",!0):L((d(),V(D,{key:0,clickable:"",onClick:r=>W(e.id)},{default:t(()=>[l(c,{avatar:""},{default:t(()=>[l(k,{icon:"delete"})]),_:1}),l(c,null,{default:t(()=>[l(b,null,{default:t(()=>a[14]||(a[14]=[v("Anular")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[O],[R]])]),_:2},1024)]),_:2},1024))]),o("td",null,u(n.$filters.dateDmYHis(e.fecha)),1),o("td",Qe,u(e.total),1),o("td",null,[v(u(e.nombre),1),a[15]||(a[15]=o("br",null,null,-1)),v(" "+u(e.mascota?.nombre),1)]),o("td",null,u(e.user?.username),1),o("td",null,[o("div",Ye,[(d(!0),f(N,null,j(e.details,r=>(d(),f("span",{key:r.id},u(r.cantidad)+" "+u(r.productoName)+", ",1))),128))])]),o("td",null,[o("div",Ae,u(e.comentarioDoctor),1)]),o("td",null,u(e.pago),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(te,{modelValue:F.value,"onUpdate:modelValue":a[8]||(a[8]=e=>F.value=e),persistent:""},{default:t(()=>[l(E,{flat:"",bordered:"",style:{width:"350px"}},{default:t(()=>[l(I,{class:"row items-center q-pb-none"},{default:t(()=>[a[17]||(a[17]=o("div",{class:"text-bold"},"Cerrar Caja",-1)),l(ie),l(x,{flat:"",dense:"",icon:"close",onClick:a[5]||(a[5]=e=>F.value=!1)})]),_:1}),l(I,null,{default:t(()=>[l(P,{onSubmit:B(H,["prevent"])},{default:t(()=>[l(w,{modelValue:$.value.monto_final,"onUpdate:modelValue":a[6]||(a[6]=e=>$.value.monto_final=e),label:"Monto Final",type:"number",outlined:"",dense:""},null,8,["modelValue"]),l(w,{type:"textarea",modelValue:$.value.observacion,"onUpdate:modelValue":a[7]||(a[7]=e=>$.value.observacion=e),label:"Observación",outlined:"",dense:""},null,8,["modelValue"]),l(x,{label:"Cerrar Caja",color:"red",type:"submit",loading:m.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a[18]||(a[18]=o("div",{id:"printArea",class:"hidden"},null,-1))],64))}},Ze=pe(Fe,[["__scopeId","data-v-1d723f9c"]]);export{Ze as default};

import{g as W,r as d,V as Z,a0 as m,o as s,a as l,b as t,w as a,Q as q,e as $,ao as N,al as h,c as v,a1 as C,f as V,W as w,$ as k,t as i,Z as b,_ as y,a2 as B,a3 as T,ak as G,h as K}from"./index-DMgRWbxc.js";import{Q as X}from"./QSelect-DSBlcWTw.js";import{Q as j}from"./QForm-z4yRst-p.js";import{Q,a as u}from"./QMenu-VN2Hi47A.js";import{Q as p}from"./QItemLabel-8NlFTlsa.js";import{a as F,Q as ee}from"./QList-Cxjac6zW.js";import{Q as le}from"./QChip-CDGhZ_v3.js";import{Q as ae}from"./QMarkupTable-0Z42urnn.js";import{Q as oe}from"./QPage-BV71loAn.js";import{Q as te}from"./QSpace-XEHKbqvf.js";import{C as L}from"./ClosePopup-C1HsyRt2.js";import{h as E}from"./moment-C5S46NFB.js";import{I as ne}from"./Imprimir-BF4csYPX.js";import{E as se}from"./Excel-CKQ98bqC.js";import"./format-DyQxkAtJ.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const de={class:"row"},ie={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ue={class:"col-12 col-md-2"},ce={class:"col-12 col-md-2 flex flex-center"},me={class:"col-12 col-md-2 flex flex-center"},fe={class:"col-12 col-md-4"},pe={class:"col-12 col-md-2 flex flex-center"},ve={class:"row"},be={key:0,class:"col-12 col-md-4 q-pa-xs"},xe={class:"text-weight-bold"},_e={key:1,class:"col-12 col-md-4 q-pa-xs"},ge={class:"text-weight-bold"},he={key:2,class:"col-12 col-md-4 q-pa-xs"},Ce={class:"text-weight-bold"},Ve={key:1},we={class:"text-right"},ke={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},ye={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},He={__name:"Sales",setup(Qe){const{proxy:x}=W(),A=d(E().format("YYYY-MM-DD")),Y=d(E().format("YYYY-MM-DD")),f=d([]),S=d([]),r=d(!1),_=d(""),U=d([]),I=d("");d("CAJA");const D=d(!1),g=d({});d([]),d(["CAJA","PRODUCTOS"]),Z(()=>{M(),z()});function O(){r.value=!0,x.$axios.post("/cajas",g.value).then(n=>{D.value=!1,x.$alert.success("Registrado correctamente",n.data)}).finally(()=>{r.value=!1})}function H(){if(!_.value){f.value=S.value;return}f.value=S.value.filter(n=>n.nombre.toLowerCase().includes(_.value.toLowerCase())||n.user?.name.toLowerCase().includes(_.value.toLowerCase()))}function P(n){ne.nota(n)}function R(){const n=[{sheet:"Ventas",columns:[{label:"Fecha",value:e=>E(e.fecha).format("DD/MM/YYYY HH:mm")},{label:"Cliente",value:e=>e.nombre},{label:"Mascota",value:e=>e.mascota?.nombre},{label:"Usuario",value:e=>e.user?.username},{label:"Total",value:e=>e.total},{label:"Comentario Doctor",value:e=>e.comentarioDoctor},{label:"Detalles",value:e=>e.details.map(o=>`${o.cantidad} ${o.productoName}`).join(", ")}],content:f.value.map(e=>({fecha:e.fecha,nombre:e.nombre,mascota:e.mascota,user:e.user,total:e.total,comentarioDoctor:e.comentarioDoctor,details:e.details}))}];se.export(n,"Ventas")}function J(n){x.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{r.value=!0,x.$axios.put(`/sales/${n}/anular`).then(()=>{M()}).finally(()=>{r.value=!1})})}function z(){U.value=[{id:"",name:"Todos"}],x.$axios.get("/users").then(n=>{n.data.forEach(e=>{U.value.push({id:e.id,name:e.name})})})}function M(){r.value=!0,x.$axios.get("/sales",{params:{fechaInicio:A.value,fechaFin:Y.value,user_id:I.value}}).then(n=>{f.value=n.data,S.value=n.data}).finally(()=>{r.value=!1})}return(n,e)=>(s(),m(B,null,[l(oe,{class:"q-pa-xs"},{default:a(()=>[l(q,{flat:"",bordered:""},{default:a(()=>[l($,{class:"q-pa-xs"},{default:a(()=>[l(j,{onSubmit:N(M,["prevent"])},{default:a(()=>[t("div",de,[t("div",ie,[l(h,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=o=>A.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",re,[l(h,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=o=>Y.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",ue,[n.$store.user.role==="Admin"?(s(),v(X,{key:0,modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=o=>I.value=o),label:"Usuario",outlined:"",dense:"",options:U.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):C("",!0)]),t("div",ce,[l(V,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:r.value},null,8,["loading"])]),e[9]||(e[9]=t("div",{class:"col-12 col-md-2"},null,-1)),t("div",me,[l(V,{label:"Excel",color:"green",icon:"fa-solid fa-file-excel","no-caps":"",loading:r.value,onClick:R},null,8,["loading"])]),e[10]||(e[10]=t("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),t("div",fe,[l(h,{modelValue:_.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>_.value=o),H],label:"Filtro",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),t("div",pe,[l(V,{style:{width:"150px"},label:"Venta",color:"positive",onClick:e[4]||(e[4]=o=>n.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:r.value},null,8,["loading"])]),e[11]||(e[11]=t("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),e[12]||(e[12]=t("div",{class:"col-12 col-md-2 flex flex-center"},null,-1))])]),_:1}),t("div",ve,[n.$store.user.role==="Admin"?(s(),m("div",be,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((s(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(k,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",xe,i(f.value.length)+" ventas ",1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[13]||(e[13]=[b(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[y]])]),_:1})])):C("",!0),n.$store.user.role==="Admin"?(s(),m("div",_e,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((s(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(k,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",ge," Bs "+i(f.value.filter(o=>!o.anulado).reduce((o,c)=>o+parseFloat(c.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[14]||(e[14]=[b(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[y]])]),_:1})])):C("",!0),n.$store.user.role==="Admin"?(s(),m("div",he,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((s(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(k,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",Ce," Bs "+i(f.value.filter(o=>o.anulado).reduce((o,c)=>o+parseFloat(c.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[15]||(e[15]=[b(" Total de ventas anuladas ")])),_:1})]),_:1})]),_:1})),[[y]])]),_:1})])):C("",!0)])]),_:1})]),_:1}),l(q,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[l($,null,{default:a(()=>[l(ae,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:a(()=>[e[19]||(e[19]=t("thead",null,[t("tr",{class:"bg-orange text-white"},[t("th",null,"Acciones"),t("th",null,"Fecha"),t("th",null,"Total"),t("th",null,"Nombre Cliente"),t("th",null,"Usuario"),t("th",null,"Detalle"),t("th",null,"Comentario Doctor")])],-1)),t("tbody",null,[(s(!0),m(B,null,T(f.value,o=>(s(),m("tr",{key:o.id},[t("td",null,[o.anulado?(s(),m("div",Ve,[l(le,{color:"red","text-color":"white",label:"Anulada"})])):(s(),v(ee,{key:0,label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"indigo",size:"10px"},{default:a(()=>[l(F,null,{default:a(()=>[w((s(),v(Q,{clickable:"",onClick:c=>P(o)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(k,{icon:"print"})]),_:1}),l(u,null,{default:a(()=>[l(p,null,{default:a(()=>e[16]||(e[16]=[b("Imprimir")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[y],[L]]),l(G),o.anulado?C("",!0):w((s(),v(Q,{key:0,clickable:"",onClick:c=>J(o.id)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(k,{icon:"delete"})]),_:1}),l(u,null,{default:a(()=>[l(p,null,{default:a(()=>e[17]||(e[17]=[b("Anular")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[y],[L]])]),_:2},1024)]),_:2},1024))]),t("td",null,i(n.$filters.dateDmYHis(o.fecha)),1),t("td",we,i(o.total),1),t("td",null,[b(i(o.nombre)+" ",1),e[18]||(e[18]=t("br",null,null,-1)),b(" "+i(o.mascota?.nombre),1)]),t("td",null,i(o.user?.username),1),t("td",null,[t("div",ke,[(s(!0),m(B,null,T(o.details,c=>(s(),m("span",{key:c.id},i(c.cantidad)+" "+i(c.productoName)+", ",1))),128))])]),t("td",null,[t("div",ye,i(o.comentarioDoctor),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(K,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=o=>D.value=o),persistent:""},{default:a(()=>[l(q,{flat:"",bordered:"",style:{width:"350px"}},{default:a(()=>[l($,{class:"row items-center q-pb-none"},{default:a(()=>[e[20]||(e[20]=t("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(te),l(V,{flat:"",dense:"",icon:"close",onClick:e[5]||(e[5]=o=>D.value=!1)})]),_:1}),l($,null,{default:a(()=>[l(j,{onSubmit:N(O,["prevent"])},{default:a(()=>[l(h,{modelValue:g.value.monto_final,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value.monto_final=o),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(h,{type:"textarea",modelValue:g.value.observacion,"onUpdate:modelValue":e[7]||(e[7]=o=>g.value.observacion=o),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(V,{label:"Cerrar Caja",color:"red",type:"submit",loading:r.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[21]||(e[21]=t("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{He as default};

import{aQ as de,g as ue,r as i,V as ce,k as pe,a0 as d,o as r,a,b as e,w as s,f as p,Q as $,e as V,ao as A,al as U,aR as me,u as ve,c as L,a1 as F,a2 as b,a3 as h,t as n,Z as C,W as H,aS as O,h as G}from"./index-DMgRWbxc.js";import{Q as W}from"./QSelect-DSBlcWTw.js";import{Q as Z}from"./QForm-z4yRst-p.js";import{Q as fe}from"./QPagination-Ddre1CLP.js";import{Q as j}from"./QChip-CDGhZ_v3.js";import{Q as w}from"./QMarkupTable-0Z42urnn.js";import{Q as E}from"./QSpace-XEHKbqvf.js";import{Q as be}from"./QPage-BV71loAn.js";import{I as ge}from"./Imprimir-BF4csYPX.js";import{h as J}from"./moment-C5S46NFB.js";import"./QMenu-VN2Hi47A.js";import"./QItemLabel-8NlFTlsa.js";import"./format-DyQxkAtJ.js";import"./_commonjsHelpers-D6-XlEtG.js";const he={class:"row"},xe={class:"col-12"},Ve={class:"col-12 col-md-7"},_e={class:"row"},ye={class:"col-12 col-md-7"},Ce={class:"col-12 col-md-3"},we={class:"col-12 col-md-2 flex flex-center"},ke={class:"row"},Te={class:"col-12 flex flex-center"},Qe=["onClick"],$e={class:"text-right"},De={class:"col-12 col-md-5"},Pe={class:"div"},Se={class:"text-h6 row items-center"},Be={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},ze=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],qe={class:"text-right"},Ue={class:"text-bold text-right"},Fe={class:"row"},Ee={class:"col-12 q-pa-xs"},Ne={class:"row"},Re={class:"col-8"},Ye={class:"col-2 flex flex-center"},Ie={class:"col-2 flex flex-center"},Ae={class:"col-12"},Le={class:"col-12"},He={class:"text-right"},Oe={class:"text-right"},Ge={class:"text-bold text-right"},We={class:"col-12 q-pa-xs"},Ze={key:0,class:"col-12"},je={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},Je={class:"text-caption q-mt-md"},Ke={style:{"max-width":"200px","white-space":"normal","line-height":"1.2"}},vt={__name:"VentaAdd",setup(Xe){const K=de(),{proxy:u}=ue(),D=i({nombre:"",fecha:new Date().toISOString().slice(0,10)}),N=i([]);i([]);const m=i([]);let _=i("");const k=i(!1),c=i(!1),P=i(1),S=i(1),T=i("Todos"),X=["Todos","Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],Q=i([]),B=i([]),g=i(null),y=i(!1),x=i(J().format("YYYY-MM-DD")),R=i([]);ce(()=>{z(),le()});function ee(o){if(!o?.tratamientoMedicamentos||o.tratamientoMedicamentos.length===0){u.$alert.error("Este tratamiento no tiene medicamentos.");return}o.tratamientoMedicamentos.forEach(l=>{const t=m.value.find(f=>f.nombre===l.medicamento);t?t.cantidadVenta+=l.cantidad:m.value.push({nombre:l.medicamento,cantidadVenta:l.cantidad,precioVenta:l.precio,tipo:"Tratamiento"})}),u.$alert.success("Tratamiento agregado al carrito."),y.value=!1}function Y(){if(!x.value){u.$alert.error("Seleccione una fecha","Error");return}c.value=!0,u.$axios.get("tratamientos",{params:{fecha:x.value}}).then(o=>{R.value=o.data}).finally(()=>{c.value=!1})}function te(){y.value=!0,x.value=J().format("YYYY-MM-DD"),Y()}function le(){u.$axios.get("mascotas",{params:{filter:""}}).then(o=>{Q.value=o.data.data})}function ae(){console.log(g.value),c.value=!0,u.$axios.post("mascotas/historial",{mascotaId:g.value.id}).then(o=>{console.log(o.data),B.value=o.data}).finally(()=>{c.value=!1})}function I(o){switch(o){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function z(){u.$axios.get("/productos",{params:{filter:_.value,page:P.value,limit:20,tipo:T.value==="Todos"?"":T.value}}).then(o=>{N.value=o.data.data,S.value=o.data.last_page})}const M=pe(()=>m.value.reduce((o,l)=>o+l.cantidadVenta*l.precioVenta,0).toFixed(2));function oe(o){const l=m.value.find(t=>t.id===o.id);l?l.cantidadVenta++:m.value.push({...o,cantidadVenta:1,precioVenta:o.precioVenta})}function ne(o){m.value.splice(o,1)}function se(){if(m.value.length===0){u.$alert.error("El carrito está vacío","Error");return}k.value=!0,g.value={id:1,nombre:"SN",propietario_nombre:"SN"}}function re(o,l){if(o===""){l(()=>{u.$axios.get("mascotas",{params:{filter:""}}).then(t=>{Q.value=t.data.data})});return}l(()=>{u.$axios.get("mascotas",{params:{filter:o}}).then(t=>{Q.value=t.data.data})})}function ie(){if(m.value.length===0){u.$alert.error("El carrito está vacío");return}c.value=!0,u.$axios.post("/sales",{mascota:g.value,total:parseFloat(M.value),productos:m.value,comentarioDoctor:D.value.comentarioDoctor}).then(async o=>{u.$alert.success("Venta realizada con éxito","Éxito"),K.push("/ventas"),ge.nota(o.data.sale)}).catch(o=>{u.$alert.error(o.response.data.message,"Error")}).finally(()=>{c.value=!1})}return(o,l)=>(r(),d(b,null,[a(be,{class:"q-pa-xs"},{default:s(()=>[e("div",he,[e("div",xe,[a(p,{label:"Atras",color:"primary",onClick:l[0]||(l[0]=t=>o.$router.push("/ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),e("div",Ve,[a($,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[a(V,null,{default:s(()=>[a(Z,{onSubmit:A(z,["prevent"])},{default:s(()=>[e("div",_e,[e("div",ye,[a(U,{modelValue:ve(_),"onUpdate:modelValue":l[1]||(l[1]=t=>me(_)?_.value=t:_=t),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",Ce,[a(W,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=t=>T.value=t),label:"Tipo",outlined:"",dense:"",options:X},null,8,["modelValue"])]),e("div",we,[a(p,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),e("div",ke,[e("div",Te,[S.value>1?(r(),L(fe,{key:0,modelValue:P.value,"onUpdate:modelValue":[l[3]||(l[3]=t=>P.value=t),z],max:S.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):F("",!0)])]),a(w,{dense:"",bordered:"",flat:""},{default:s(()=>[l[12]||(l[12]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Stock")])],-1)),e("tbody",null,[(r(!0),d(b,null,h(N.value,t=>(r(),d("tr",{onClick:f=>oe(t),key:t.id,style:{cursor:"pointer"}},[e("td",null,n(t.codigo),1),e("td",null,n(t.nombre),1),e("td",null,[a(j,{dense:"",color:I(t.tipo),size:"10px"},{default:s(()=>[C(n(t.tipo),1)]),_:2},1032,["color"])]),e("td",$e,n(t.precioVenta),1),e("td",null,n(t.stock),1)],8,Qe))),128))])]),_:1})]),_:1})]),_:1})]),e("div",De,[a($,{flat:"",bordered:"",class:"q-ma-xs"},{default:s(()=>[a(V,null,{default:s(()=>[e("div",Pe,[e("div",Se,[e("div",null,[l[13]||(l[13]=C(" Carrito ")),a(p,{icon:"history",color:"blue",dense:"",onClick:te,loading:c.value,size:"10px",label:"Recuperar Tratamiento","no-caps":""},null,8,["loading"])]),a(E),a(p,{icon:"delete",color:"red",dense:"",onClick:l[4]||(l[4]=t=>m.value=[]),loading:c.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),l[14]||(l[14]=e("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),a(w,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[l[17]||(l[17]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(r(!0),d(b,null,h(m.value,(t,f)=>(r(),d("tr",{key:f},[e("td",null,[e("div",Be,n(t.nombre),1)]),e("td",null,[H(e("input",{"onUpdate:modelValue":v=>t.cantidadVenta=v,type:"number",style:{width:"50px"},min:"1"},null,8,ze),[[O,t.cantidadVenta,void 0,{number:!0}]])]),e("td",null,[H(e("input",{"onUpdate:modelValue":v=>t.precioVenta=v,type:"number",style:{width:"80px"},min:"1",step:"0.1"},null,8,Me),[[O,t.precioVenta,void 0,{number:!0}]])]),e("td",qe,n((t.cantidadVenta*t.precioVenta).toFixed(2))+" Bs",1),e("td",null,[a(p,{icon:"delete",color:"red",dense:"",onClick:v=>ne(f),loading:c.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),e("tfoot",null,[e("tr",null,[l[15]||(l[15]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Ue,n(M.value)+" Bs",1),l[16]||(l[16]=e("td",null,null,-1))])])]),_:1}),a(p,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:se,loading:c.value},null,8,["loading"])]),_:1})]),_:1})])]),a(G,{modelValue:k.value,"onUpdate:modelValue":l[8]||(l[8]=t=>k.value=t)},{default:s(()=>[a($,{flat:"",bordered:"",style:{"max-width":"750px"}},{default:s(()=>[a(V,{class:"q-pb-none row items-center"},{default:s(()=>[l[18]||(l[18]=e("div",{class:"text-bold"}," Realizar Venta ",-1)),a(E),a(p,{flat:"",dense:"",round:"",icon:"close",onClick:l[5]||(l[5]=t=>k.value=!1)})]),_:1}),a(V,null,{default:s(()=>[a(Z,{onSubmit:A(ie,["prevent"])},{default:s(()=>[e("div",Fe,[e("div",Ee,[e("div",Ne,[e("div",Re,[a(W,{"input-debounce":"300",clearable:"","use-input":"",modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=t=>g.value=t),label:"Mascota",outlined:"",dense:"",options:Q.value,"option-label":t=>t.id+"|"+t.nombre+"|"+t.propietario_nombre,"option-value":t=>t.id,onFilter:re,rules:[t=>!!t||"Campo requerido"]},null,8,["modelValue","options","option-label","option-value","rules"])]),e("div",Ye,[a(p,{loading:c.value,dense:"",color:"green",label:"Crear","no-caps":"",icon:"add_circle_outline",to:"/mascotas/create"},null,8,["loading"])]),e("div",Ie,[g.value?(r(),L(p,{key:0,loading:c.value,dense:"",color:"blue",label:"historial","no-caps":"",icon:"history",onClick:ae},null,8,["loading"])):F("",!0)])])]),e("div",Ae,[a(U,{modelValue:D.value.comentarioDoctor,"onUpdate:modelValue":l[7]||(l[7]=t=>D.value.comentarioDoctor=t),label:"Comentario Doctor",outlined:"",dense:"",type:"textarea",rows:"2"},null,8,["modelValue"])]),e("div",Le,[a(w,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:s(()=>[l[20]||(l[20]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(r(!0),d(b,null,h(m.value,(t,f)=>(r(),d("tr",{key:f},[e("td",null,n(t.nombre),1),e("td",null,n(t.cantidadVenta),1),e("td",null,[a(j,{dense:"",color:I(t.tipo),size:"10px"},{default:s(()=>[C(n(t.tipo),1)]),_:2},1032,["color"])]),e("td",He,n(t.precioVenta)+" Bs",1),e("td",Oe,n((t.cantidadVenta*t.precioVenta).toFixed(2))+" Bs",1)]))),128))]),e("tfoot",null,[e("tr",null,[l[19]||(l[19]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Ge,n(M.value)+" Bs",1)])])]),_:1})]),e("div",We,[a(p,{label:"Realizar Venta",color:"positive",class:"full-width",type:"submit","no-caps":"",loading:c.value},null,8,["loading"])]),B.value.length>0?(r(),d("div",Ze,[l[23]||(l[23]=e("div",{class:"text-h6 row items-center"}," Historial de Compras ",-1)),a(w,{flat:"",bordered:"",dense:""},{default:s(()=>[l[22]||(l[22]=e("thead",null,[e("tr",null,[e("td",null,"#"),e("td",null,"Fecha"),e("td",null,"Total"),e("td",null,"Anulado"),e("td",null,"Detalles")])],-1)),e("tbody",null,[(r(!0),d(b,null,h(B.value,(t,f)=>(r(),d("tr",{key:f},[e("td",null,n(t.id),1),e("td",null,n(t.fecha.slice(0,10)),1),e("td",null,n(t.total),1),e("td",null,n(t.anulado?"Si":"No"),1),e("td",null,[e("div",je,[(r(!0),d(b,null,h(t.details,(v,q)=>(r(),d("span",{key:q},[C(n(v.productoName)+" ("+n(v.cantidad)+")",1),l[21]||(l[21]=e("br",null,null,-1))]))),128))])])]))),128))])]),_:1})])):F("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(G,{modelValue:y.value,"onUpdate:modelValue":l[11]||(l[11]=t=>y.value=t)},{default:s(()=>[a($,{flat:"",bordered:"",style:{width:"650px"}},{default:s(()=>[a(V,{class:"q-pb-none row items-center"},{default:s(()=>[l[24]||(l[24]=e("div",{class:"text-bold"}," Recuperar Tratamiento ",-1)),a(E),a(p,{flat:"",dense:"",round:"",icon:"close",onClick:l[9]||(l[9]=t=>y.value=!1)})]),_:1}),a(V,null,{default:s(()=>[l[27]||(l[27]=e("div",{class:"text-caption"},"Seleccione una fecha para recuperar el tratamiento",-1)),a(U,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=t=>x.value=t),type:"date",outlined:"",dense:"",rules:[t=>!!t||"Campo requerido"]},{append:s(()=>[a(p,{dense:"",color:"green",label:"Buscar","no-caps":"",icon:"search",onClick:Y,loading:c.value},null,8,["loading"])]),_:1},8,["modelValue","rules"]),e("div",Je," Tratamientos realizados el "+n(x.value)+": ",1),a(w,{flat:"",bordered:"",dense:""},{default:s(()=>[l[26]||(l[26]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Fecha"),e("th",null,"Doctor"),e("th",null,"Costo"),e("th",null,"Medicamentos"),e("th",null,"Opciones")])],-1)),e("tbody",null,[(r(!0),d(b,null,h(R.value,(t,f)=>(r(),d("tr",{key:f},[e("td",null,n(t.id),1),e("td",null,n(t.fecha.slice(0,10)),1),e("td",null,n(t.user?.username||"Desconocido"),1),e("td",null,n(t.costo)+" Bs",1),e("td",null,[e("div",Ke,[(r(!0),d(b,null,h(t.tratamientoMedicamentos,(v,q)=>(r(),d("span",{key:q},[C(n(v.medicamento)+" ("+n(v.cantidad)+" x "+n(v.precio)+" Bs) ",1),l[25]||(l[25]=e("br",null,null,-1))]))),128))])]),e("td",null,[a(p,{label:"Recuperar","no-caps":"",dense:"",color:"green",icon:"add_circle_outline",onClick:v=>ee(t)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l[28]||(l[28]=e("div",{id:"myElement"},null,-1))],64))}};export{vt as default};

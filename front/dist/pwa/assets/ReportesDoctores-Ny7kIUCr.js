import{g as $,r as T,a1 as O,c as N,o as r,w as g,a as m,Q as P,a8 as k,e as w,at as A,f as D,I as B,a7 as d,a9 as v,aa as F,b as t,t as n,a4 as S}from"./index-Dz_8rEAN.js";import{Q}from"./QMarkupTable-CWX5i4C8.js";import{Q as R}from"./QPage-thSGn_PQ.js";import{E}from"./jspdf.es.min-Br7KHKFS.js";import{a as M}from"./jspdf.plugin.autotable-CZ1gY-nI.js";import{h as Y}from"./moment-C5S46NFB.js";const y=h=>Number(h||0).toFixed(2);function V(h,_){const e=new E({orientation:"portrait",unit:"mm",format:"A4"}),i=new Date(_).toLocaleDateString();e.setFontSize(16),e.text("REPORTE DE TRATAMIENTOS POR DOCTOR",14,15),e.setFontSize(10),e.text(`Fecha: ${i}`,14,22);let l=28;for(const x in h){const f=h[x]||[],b=f.length,s=f.reduce((a,u)=>a+Number(u.costo||0),0);e.setFontSize(10),e.text(`Doctor: ${x}`,12,l);const c=f.map(a=>{const u=(a.medicamentos||[]).map(o=>`• ${o.medicamento||""}${o.productoNombre?` (${o.productoNombre})`:""} — ${o.cantidad} x ${y(o.precio)} = ${y(o.total||o.cantidad*o.precio)}`).join(`
`);return[a.nroFicha??"",a.detalle||"","1",y(a.costo),u||"Sin medicamentos"]});M(e,{startY:l+4,head:[["Nro Ficha","Detalle","Cant","Bs","Medicamentos / Productos"]],body:c,styles:{fontSize:8,cellPadding:1.5,overflow:"linebreak",valign:"top"},headStyles:{fillColor:[22,160,133],fontSize:8},theme:"grid",margin:{left:12,right:12},columnStyles:{0:{cellWidth:20,halign:"center"},1:{cellWidth:60},2:{cellWidth:12,halign:"center"},3:{cellWidth:20,halign:"right"},4:{cellWidth:74}},didDrawPage(a){l=a.cursor.y}});const p=e.lastAutoTable&&e.lastAutoTable.finalY||l;e.setFont(void 0,"bold"),e.text(`TOTAL TRATAMIENTOS: ${b}`,100,p+6),e.text(`TOTAL Bs: ${y(s)}`,180,p+6,{align:"right"}),e.setFont(void 0,"normal"),l=p+10,l>260&&(e.addPage(),l=20)}e.save(`Reporte-Tratamientos-${i}.pdf`)}const z={class:"text-h6 text-primary"},I={class:"text-center"},L={class:"text-left"},W={style:{"max-width":"320px","white-space":"normal","line-height":"1.1"}},q={class:"text-right"},j={class:"text-left"},U={style:{"max-width":"420px","white-space":"normal","line-height":"1.1"}},G={key:0},H={key:1,class:"text-grey"},J={class:"bg-blue-1 text-bold"},K={class:"text-center"},X={class:"text-right"},lt={__name:"ReportesDoctores",setup(h){const{proxy:_}=$(),e=T(Y().format("YYYY-MM-DD")),i=T({}),l=T(!1);O(()=>{x()});const x=async()=>{if(e.value){l.value=!0;try{const{data:b}=await _.$axios.get("/reportes/tratamientos-por-doctor",{params:{fecha:e.value}});i.value=b||{}}finally{l.value=!1}}},f=()=>{V(i.value,e.value)};return(b,s)=>(r(),N(R,{class:"q-pa-md bg-grey-2"},{default:g(()=>[m(P,null,{default:g(()=>[m(w,{class:"row q-gutter-sm"},{default:g(()=>[m(A,{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=c=>e.value=c),label:"Selecciona Fecha",type:"date",outlined:"",dense:"",class:"col-4"},null,8,["modelValue"]),m(D,{label:"Buscar",color:"primary",onClick:x,loading:l.value},null,8,["loading"]),m(D,{label:"Exportar PDF",color:"deep-orange",icon:"picture_as_pdf",onClick:f,disable:Object.keys(i.value).length===0},null,8,["disable"])]),_:1}),m(B),Object.keys(i.value).length>0?(r(),N(w,{key:0},{default:g(()=>[(r(!0),d(v,null,F(i.value,(c,p)=>(r(),d("div",{key:p,class:"q-mb-md"},[t("div",z,n(p),1),m(Q,{dense:"",bordered:"",flat:"",class:"bg-white"},{default:g(()=>[s[4]||(s[4]=t("thead",null,[t("tr",{class:"text-center"},[t("th",{style:{width:"90px"}},"Nro Ficha"),t("th",null,"Detalle"),t("th",{style:{width:"60px"}},"Cant"),t("th",{style:{width:"110px"}},"Bs"),t("th",{style:{"min-width":"260px"}},"Medicamentos / Productos")])],-1)),t("tbody",null,[(r(!0),d(v,null,F(c,(a,u)=>(r(),d("tr",{key:u},[t("td",I,n(a.nroFicha),1),t("td",L,[t("div",W,n(a.detalle||"—"),1)]),s[1]||(s[1]=t("td",{class:"text-center"},"1",-1)),t("td",q,n(Number(a.costo||0).toFixed(2)),1),t("td",j,[t("div",U,[a.medicamentos&&a.medicamentos.length?(r(!0),d(v,{key:0},F(a.medicamentos,(o,C)=>(r(),d("div",{key:C,class:"q-mb-xs"},[S(" • "+n(o.medicamento)+" ",1),o.productoNombre?(r(),d("span",G," ("+n(o.productoNombre)+")",1)):k("",!0),S(" — "+n(o.cantidad)+" x "+n(Number(o.precio||0).toFixed(2))+" = ",1),t("b",null,n(Number(o.total||o.cantidad*o.precio||0).toFixed(2)),1)]))),128)):(r(),d("span",H,"Sin medicamentos"))])])]))),128)),t("tr",J,[s[2]||(s[2]=t("td",{colspan:"2",class:"text-right"},"TOTAL",-1)),t("td",K,n(c.length),1),t("td",X,n(c.reduce((a,u)=>a+Number(u.costo||0),0).toFixed(2)),1),s[3]||(s[3]=t("td",null,null,-1))])])]),_:2},1024)]))),128))]),_:1})):k("",!0)]),_:1})]),_:1}))}};export{lt as default};

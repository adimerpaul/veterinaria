import{aW as me,g as ve,r as i,a1 as fe,k as be,a7 as p,o as d,a as o,b as e,w as r,f as m,Q,e as x,aw as R,at as _,aX as ge,u as M,c as X,a8 as Y,a9 as V,aa as y,t as n,a4 as P,J as K,aY as Z,h as A,au as xe,I as Ve,av as he}from"./index-CeLS1kfd.js";import{Q as z}from"./QSelect-Cr40Q5mg.js";import{Q as L}from"./QForm-B0DFzUrN.js";import{Q as _e}from"./QPagination-qufjQHqo.js";import{Q as ee}from"./QChip-BQ60xaLu.js";import{Q as S}from"./QMarkupTable-BZbS-C9N.js";import{Q as O}from"./QSpace-D-MpJVm-.js";import{Q as ye}from"./QPage-g5g7VCmC.js";import{I as Ce}from"./Imprimir-j96HB3l0.js";import{h as le}from"./moment-C5S46NFB.js";import"./QMenu-BNcm7Ouo.js";import"./QItemLabel-B5ElpcAC.js";import"./format-DyQxkAtJ.js";import"./numeroaletras-B5rgbfjP.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-ByRWkf4M.js";const we={class:"row"},ke={class:"col-12"},$e={class:"col-12 col-md-7"},Te={class:"row"},Qe={class:"col-12 col-md-7"},Pe={class:"col-12 col-md-3"},Se={class:"col-12 col-md-2 flex flex-center"},De={class:"row"},Ue={class:"col-12 flex flex-center"},Me=["onClick"],ze={class:"text-right"},qe={class:"col-12 col-md-5"},Be={class:"div"},Ee={class:"text-h6 row items-center"},Ne={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},Fe=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],Re={class:"text-right"},Ye={class:"text-bold text-right"},Ae={class:"row"},Le={class:"col-12 q-pa-xs"},Oe={class:"row"},Ge={class:"col-6"},He={class:"col-2 text-center"},je={class:"col-2 flex flex-center"},Je={class:"col-2 flex flex-center"},We={class:"col-12"},Xe={class:"col-12"},Ke={class:"text-right"},Ze={class:"text-right"},el={class:"text-bold text-right"},ll={class:"col-12 q-pa-xs"},al={key:0,class:"col-12"},ol={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},tl={class:"text-caption q-mt-md"},nl={style:{"max-width":"150px","white-space":"normal","line-height":"0.9"}},rl={style:{"max-width":"200px","white-space":"normal","line-height":"1.2"}},sl={class:"row q-col-gutter-md"},il={class:"col-6"},dl={class:"col-6"},ul={class:"col-6"},cl={class:"col-6"},pl={class:"col-12"},Sl={__name:"VentaAdd",setup(ml){me();const{proxy:s}=ve(),h=i({nombre:"",fecha:new Date().toISOString().slice(0,10)}),G=i([]);i([]);const v=i([]);let w=i("");const k=i(!1),c=i(!1),q=i(1),B=i(1),D=i("Todos"),ae=["Todos","Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],U=i([]),E=i([]),g=i(null),$=i(!1),C=i(le().format("YYYY-MM-DD")),H=i([]),T=i(!1);fe(()=>{N(),J(),g.value={id:1,nombre:"SN",propietario_nombre:"SN"}});const f=i({nombre:"",especie:"",propietario_nombre:"",propietario_telefono:"",propietario_ciudad:"Oruro"}),oe=i(["Oruro","La Paz","Santa Cruz","Cochabamba","Sucre","Tarija","Potosí","Beni","Pando","Chuquisaca"]);async function te(){try{c.value=!0;const t=await s.$axios.post("/mascotas",f.value);s.$alert.success("Mascota registrada correctamente"),T.value=!1,await J(),g.value=t.data,f.value={nombre:"",especie:"",propietario_nombre:"",propietario_telefono:"",propietario_ciudad:"Oruro"}}catch{s.$alert.error("No se pudo registrar la mascota")}finally{c.value=!1}}function ne(t){if(!t?.tratamientoMedicamentos||t.tratamientoMedicamentos.length===0){s.$alert.error("Este tratamiento no tiene medicamentos.");return}s.$axios.put(`tratamientos/pagado/${t.id}`,{pagado:!0}).then(()=>{}).catch(a=>{s.$alert.error("Error al marcar el tratamiento como pagado.")}),v.value=[],t.tratamientoMedicamentos.forEach(a=>{const l=v.value.find(b=>b.nombre===a.medicamento);l?l.cantidadVenta+=a.cantidad:v.value.push({id:a.producto?.id,nombre:a.medicamento,cantidadVenta:parseInt(a.cantidad),precioVenta:a.precio,tipo:"Tratamiento"})}),g.value={id:t.historiale?.mascota?.id,nombre:t.historiale?.mascota?.nombre,propietario_nombre:t.historiale?.mascota?.propietario_nombre},s.$alert.success("Tratamiento agregado al carrito."),$.value=!1}function j(){if(!C.value){s.$alert.error("Seleccione una fecha","Error");return}c.value=!0,s.$axios.get("tratamientos",{params:{fecha:C.value}}).then(t=>{H.value=t.data}).finally(()=>{c.value=!1})}function re(){$.value=!0,C.value=le().format("YYYY-MM-DD"),j()}function J(){s.$axios.get("mascotas",{params:{filter:""}}).then(t=>{U.value=t.data.data})}function se(){console.log(g.value),c.value=!0,s.$axios.post("mascotas/historial",{mascotaId:g.value.id}).then(t=>{console.log(t.data),E.value=t.data}).finally(()=>{c.value=!1})}function W(t){switch(t){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function N(){s.$axios.get("/productos",{params:{filter:w.value,page:q.value,limit:20,tipo:D.value==="Todos"?"":D.value}}).then(t=>{G.value=t.data.data,B.value=t.data.last_page})}const F=be(()=>v.value.reduce((t,a)=>t+a.cantidadVenta*a.precioVenta,0).toFixed(2));function ie(t){const a=v.value.find(l=>l.id===t.id);a?a.cantidadVenta++:v.value.push({...t,cantidadVenta:1,precioVenta:t.precioVenta})}function de(t){v.value.splice(t,1)}function ue(){if(v.value.length===0){s.$alert.error("El carrito está vacío","Error");return}k.value=!0,h.value={comentarioDoctor:"",pago:"Efectivo"}}function ce(t,a){if(t===""){a(()=>{s.$axios.get("mascotas",{params:{filter:""}}).then(l=>{U.value=l.data.data})});return}a(()=>{s.$axios.get("mascotas",{params:{filter:t}}).then(l=>{U.value=l.data.data})})}function pe(){if(v.value.length===0){s.$alert.error("El carrito está vacío");return}c.value=!0,s.$axios.post("/sales",{mascota:g.value,total:parseFloat(F.value),productos:v.value,comentarioDoctor:h.value.comentarioDoctor,pago:h.value.pago}).then(async t=>{Ce.nota(t.data.sale),g.value={id:1,nombre:"SN",propietario_nombre:"SN"},k.value=!1,v.value=[],s.$alert.success("Venta realizada con éxito","Éxito")}).catch(t=>{s.$alert.error(t.response.data.message,"Error")}).finally(()=>{c.value=!1})}return(t,a)=>(d(),p(V,null,[o(ye,{class:"q-pa-xs"},{default:r(()=>[e("div",we,[e("div",ke,[o(m,{label:"Atras",color:"primary",onClick:a[0]||(a[0]=l=>t.$router.push("/ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),e("div",$e,[o(Q,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[o(x,null,{default:r(()=>[o(L,{onSubmit:R(N,["prevent"])},{default:r(()=>[e("div",Te,[e("div",Qe,[o(_,{modelValue:M(w),"onUpdate:modelValue":a[1]||(a[1]=l=>ge(w)?w.value=l:w=l),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",Pe,[o(z,{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=l=>D.value=l),label:"Tipo",outlined:"",dense:"",options:ae},null,8,["modelValue"])]),e("div",Se,[o(m,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),e("div",De,[e("div",Ue,[B.value>1?(d(),X(_e,{key:0,modelValue:q.value,"onUpdate:modelValue":[a[3]||(a[3]=l=>q.value=l),N],max:B.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):Y("",!0)])]),o(S,{dense:"",bordered:"",flat:""},{default:r(()=>[a[21]||(a[21]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Stock")])],-1)),e("tbody",null,[(d(!0),p(V,null,y(G.value,l=>(d(),p("tr",{onClick:b=>ie(l),key:l.id,style:{cursor:"pointer"}},[e("td",null,n(l.codigo),1),e("td",null,n(l.nombre),1),e("td",null,[o(ee,{dense:"",color:W(l.tipo),size:"10px"},{default:r(()=>[P(n(l.tipo),1)]),_:2},1032,["color"])]),e("td",ze,n(l.precioVenta),1),e("td",null,n(l.stock),1)],8,Me))),128))])]),_:1})]),_:1})]),_:1})]),e("div",qe,[o(Q,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[o(x,null,{default:r(()=>[e("div",Be,[e("div",Ee,[e("div",null,[a[22]||(a[22]=P(" Carrito ")),o(m,{icon:"history",color:"blue",dense:"",onClick:re,loading:c.value,size:"10px",label:"Recuperar Tratamiento","no-caps":""},null,8,["loading"])]),o(O),o(m,{icon:"delete",color:"red",dense:"",onClick:a[4]||(a[4]=l=>v.value=[]),loading:c.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),a[23]||(a[23]=e("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),o(S,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[a[26]||(a[26]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(d(!0),p(V,null,y(v.value,(l,b)=>(d(),p("tr",{key:b},[e("td",null,[e("div",Ne,n(l.nombre),1)]),e("td",null,[K(e("input",{"onUpdate:modelValue":u=>l.cantidadVenta=u,type:"number",style:{width:"50px"},min:"1"},null,8,Fe),[[Z,l.cantidadVenta,void 0,{number:!0}]])]),e("td",null,[K(e("input",{"onUpdate:modelValue":u=>l.precioVenta=u,type:"number",style:{width:"80px"},min:"1",step:"0.1"},null,8,Ie),[[Z,l.precioVenta,void 0,{number:!0}]])]),e("td",Re,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1),e("td",null,[o(m,{icon:"delete",color:"red",dense:"",onClick:u=>de(b),loading:c.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),e("tfoot",null,[e("tr",null,[a[24]||(a[24]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Ye,n(F.value)+" Bs",1),a[25]||(a[25]=e("td",null,null,-1))])])]),_:1}),o(m,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:ue,loading:c.value},null,8,["loading"])]),_:1})]),_:1})])]),o(A,{modelValue:k.value,"onUpdate:modelValue":a[10]||(a[10]=l=>k.value=l)},{default:r(()=>[o(Q,{flat:"",bordered:"",style:{"max-width":"750px"}},{default:r(()=>[o(x,{class:"q-pb-none row items-center"},{default:r(()=>[a[27]||(a[27]=e("div",{class:"text-bold"}," Realizar Venta ",-1)),o(O),o(m,{flat:"",dense:"",round:"",icon:"close",onClick:a[5]||(a[5]=l=>k.value=!1)})]),_:1}),o(x,null,{default:r(()=>[o(L,{onSubmit:R(pe,["prevent"])},{default:r(()=>[e("div",Ae,[e("div",Le,[e("div",Oe,[e("div",Ge,[o(z,{"input-debounce":"300",clearable:"","use-input":"",modelValue:g.value,"onUpdate:modelValue":a[6]||(a[6]=l=>g.value=l),label:"Mascota",outlined:"",dense:"",options:U.value,"option-label":l=>l.id+"|"+l.nombre+"|"+l.propietario_nombre,"option-value":l=>l.id,onFilter:ce,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","option-label","option-value","rules"])]),e("div",He,[o(z,{modelValue:h.value.pago,"onUpdate:modelValue":a[7]||(a[7]=l=>h.value.pago=l),label:"Pago",outlined:"",dense:"",options:["Efectivo","Qr","Transferencia"],hint:""},null,8,["modelValue"])]),e("div",je,[o(m,{dense:"",color:"green",label:"Crear","no-caps":"",icon:"add_circle_outline",onClick:a[8]||(a[8]=l=>T.value=!0)})]),e("div",Je,[g.value?(d(),X(m,{key:0,loading:c.value,dense:"",color:"blue",label:"historial","no-caps":"",icon:"history",onClick:se},null,8,["loading"])):Y("",!0)])])]),e("div",We,[o(_,{modelValue:h.value.comentarioDoctor,"onUpdate:modelValue":a[9]||(a[9]=l=>h.value.comentarioDoctor=l),label:"Comentario Doctor",outlined:"",dense:"",type:"textarea",rows:"2"},null,8,["modelValue"])]),e("div",Xe,[o(S,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[a[29]||(a[29]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(d(!0),p(V,null,y(v.value,(l,b)=>(d(),p("tr",{key:b},[e("td",null,n(l.nombre),1),e("td",null,n(l.cantidadVenta),1),e("td",null,[o(ee,{dense:"",color:W(l.tipo),size:"10px"},{default:r(()=>[P(n(l.tipo),1)]),_:2},1032,["color"])]),e("td",Ke,n(l.precioVenta)+" Bs",1),e("td",Ze,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1)]))),128))]),e("tfoot",null,[e("tr",null,[a[28]||(a[28]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",el,n(F.value)+" Bs",1)])])]),_:1})]),e("div",ll,[o(m,{label:"Realizar Venta",color:"positive",class:"full-width",type:"submit","no-caps":"",loading:c.value},null,8,["loading"])]),E.value.length>0?(d(),p("div",al,[a[32]||(a[32]=e("div",{class:"text-h6 row items-center"}," Historial de Compras ",-1)),o(S,{flat:"",bordered:"",dense:""},{default:r(()=>[a[31]||(a[31]=e("thead",null,[e("tr",null,[e("td",null,"#"),e("td",null,"Fecha"),e("td",null,"Total"),e("td",null,"Anulado"),e("td",null,"Detalles")])],-1)),e("tbody",null,[(d(!0),p(V,null,y(E.value,(l,b)=>(d(),p("tr",{key:b},[e("td",null,n(l.id),1),e("td",null,n(l.fecha.slice(0,10)),1),e("td",null,n(l.total),1),e("td",null,n(l.anulado?"Si":"No"),1),e("td",null,[e("div",ol,[(d(!0),p(V,null,y(l.details,(u,I)=>(d(),p("span",{key:I},[P(n(u.productoName)+" ("+n(u.cantidad)+")",1),a[30]||(a[30]=e("br",null,null,-1))]))),128))])])]))),128))])]),_:1})])):Y("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(A,{modelValue:$.value,"onUpdate:modelValue":a[13]||(a[13]=l=>$.value=l)},{default:r(()=>[o(Q,{flat:"",bordered:"",style:{"min-width":"600px","max-width":"90vw"}},{default:r(()=>[o(x,{class:"q-pb-none row items-center"},{default:r(()=>[a[33]||(a[33]=e("div",{class:"text-bold"}," Recuperar Tratamiento ",-1)),o(O),o(m,{flat:"",dense:"",round:"",icon:"close",onClick:a[11]||(a[11]=l=>$.value=!1)})]),_:1}),o(x,null,{default:r(()=>[a[36]||(a[36]=e("div",{class:"text-caption"},"Seleccione una fecha para recuperar el tratamiento",-1)),o(_,{modelValue:C.value,"onUpdate:modelValue":a[12]||(a[12]=l=>C.value=l),type:"date",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},{append:r(()=>[o(m,{dense:"",color:"green",label:"Buscar","no-caps":"",icon:"search",onClick:j,loading:c.value},null,8,["loading"])]),_:1},8,["modelValue","rules"]),e("div",tl," Tratamientos realizados el "+n(C.value)+": ",1),o(S,{flat:"",bordered:"",dense:""},{default:r(()=>[a[35]||(a[35]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Fecha"),e("th",null,"Doctor"),e("th",null,"Mascota"),e("th",null,"Costo"),e("th",null,"Medicamentos"),e("th",null,"Opciones"),e("th",null,"Pagado")])],-1)),e("tbody",null,[(d(!0),p(V,null,y(H.value,(l,b)=>(d(),p("tr",{key:b},[e("td",null,n(l.id),1),e("td",null,n(l.fecha.slice(0,10)),1),e("td",null,n(l.user?.username||"Desconocido"),1),e("td",null,[e("div",nl,n(l.historiale?.mascota?.nombre||"Desconocido")+" ("+n(l.historiale?.mascota?.propietario_nombre||"Desconocido")+") ",1)]),e("td",null,n(l.costo)+" Bs",1),e("td",null,[e("div",rl,[(d(!0),p(V,null,y(l.tratamientoMedicamentos,(u,I)=>(d(),p("span",{key:I},[P(n(u.medicamento)+" ("+n(u.cantidad)+" x "+n(u.precio)+" Bs) ",1),a[34]||(a[34]=e("br",null,null,-1))]))),128))])]),e("td",null,[o(m,{label:"Recuperar","no-caps":"",dense:"",color:"green",icon:"add_circle_outline",size:"10px",onClick:u=>ne(l)},null,8,["onClick"])]),e("td",null,[o(xe,{modelValue:l.pagado,"onUpdate:modelValue":[u=>l.pagado=u,u=>{M(s).$axios.put(`tratamientos/pagado/${l.id}`,{pagado:u}).then(()=>{M(s).$alert.success(`Tratamiento ${u?"marcado como pagado":"desmarcado como pagado"}.`)}).catch(()=>{M(s).$alert.error("Error al actualizar el estado del tratamiento.")})}],"true-value":!0,"false-value":!1,color:"green",size:"20px"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(A,{modelValue:T.value,"onUpdate:modelValue":a[20]||(a[20]=l=>T.value=l),persistent:""},{default:r(()=>[o(Q,{style:{width:"800px","max-width":"90vw"}},{default:r(()=>[o(x,null,{default:r(()=>a[37]||(a[37]=[e("div",{class:"text-h6"},"Registrar Mascota",-1)])),_:1}),o(Ve),o(x,null,{default:r(()=>[o(L,{onSubmit:R(te,["prevent"])},{default:r(()=>[e("div",sl,[e("div",il,[o(_,{modelValue:f.value.nombre,"onUpdate:modelValue":a[14]||(a[14]=l=>f.value.nombre=l),label:"Nombre",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),e("div",dl,[o(_,{modelValue:f.value.propietario_nombre,"onUpdate:modelValue":a[15]||(a[15]=l=>f.value.propietario_nombre=l),label:"Propietario",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),e("div",ul,[o(_,{modelValue:f.value.propietario_telefono,"onUpdate:modelValue":a[16]||(a[16]=l=>f.value.propietario_telefono=l),label:"Teléfono",outlined:"",dense:""},null,8,["modelValue"])]),e("div",cl,[o(z,{modelValue:f.value.propietario_ciudad,"onUpdate:modelValue":a[17]||(a[17]=l=>f.value.propietario_ciudad=l),label:"Ciudad",outlined:"",dense:"",options:oe.value},null,8,["modelValue","options"])]),e("div",pl,[o(_,{modelValue:f.value.especie,"onUpdate:modelValue":a[18]||(a[18]=l=>f.value.especie=l),label:"Especie",outlined:"",dense:""},null,8,["modelValue"])])]),o(he,{align:"right",class:"q-mt-md"},{default:r(()=>[o(m,{flat:"",label:"Cancelar",color:"negative",onClick:a[19]||(a[19]=l=>T.value=!1)}),o(m,{label:"Guardar",type:"submit",color:"positive",loading:c.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[38]||(a[38]=e("div",{id:"myElement"},null,-1))],64))}};export{Sl as default};

import{c as u,o as n,w as a,a as o,Q as x,e as Q,b as r,an as p,d as m,f as g,a1 as y,a0 as _,a2 as I,a3 as T,W as b,Z as f,_ as V,t as c,h as E,aq as U}from"./index-BQzGckS2.js";import{Q as w}from"./QSelect-Br2Kbmgp.js";import{Q as D}from"./QForm-BtWW1RqC.js";import{Q as N}from"./QPagination-DjgLcZee.js";import{Q as C,a as d}from"./QMenu-MVBF9-Pt.js";import{Q as S,a as G}from"./QList-pjwxRsJN.js";import{Q as q}from"./QImg-CJTndnwz.js";import{Q as B}from"./QChip-CDkvs-uL.js";import{Q as z}from"./QMarkupTable-DmwAH9JT.js";import{Q as L}from"./QSpace-CJNtNJot.js";import{Q as F}from"./QPage-BJWwXlpo.js";import{C as k}from"./ClosePopup-BqBVr26D.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QItemLabel-CIraevKe.js";import"./format-DyQxkAtJ.js";const O={name:"ProductosPage",data(){return{tipos:["Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],productos:[],productosAll:[],producto:{},productoDialog:!1,loading:!1,actionProducto:"",filter:"",filterTipo:"Todos",totalPages:1,currentPage:1}},mounted(){this.productosGet()},methods:{cambiarImagen(i){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=()=>{const P=e.files[0];if(!P)return;const v=new FormData;v.append("photo",P),this.loading=!0,this.$axios.post(`productos/${i}/imagen`,v,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.$alert.success("Imagen actualizada"),this.productosGet()}).catch(l=>{this.$alert.error(l.response?.data?.message||"Error al subir imagen")}).finally(()=>{this.loading=!1})},e.click()},verImagen(i){this.$q.dialog({title:"Imagen",message:`<img src="${this.$url}uploads/${i}" style="width: 100%; height: auto;" />`,html:!0,persistent:!0,ok:{label:"Cerrar",color:"primary"}})},getColor(i){switch(i){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}},productosFilter(){this.filter?this.productos=this.productosAll.filter(i=>i.nombre.toLowerCase().includes(this.filter.toLowerCase())):this.productos=this.productosAll},productoNew(){this.producto={medicamento:"",forma_farmaceutica:"",concentracion:"",precio:0,stock:0,tipo:"Producto",imagen:null,categoria_id:null},this.actionProducto="Nuevo",this.productoDialog=!0},productosGet(){this.loading=!0,this.$axios.get("productos",{params:{filter:this.filter,page:this.currentPage,limit:20,tipo:this.filterTipo==="Todos"?"":this.filterTipo}}).then(i=>{this.productos=i.data.data,this.totalPages=i.data.last_page}).catch(i=>{this.$alert.error(i.response?.data?.message||"Error al cargar productos")}).finally(()=>{this.loading=!1})},productoPost(){this.loading=!0,this.$axios.post("productos",this.producto).then(()=>{this.productoDialog=!1,this.productosGet(),this.$alert.success("Producto creado correctamente")}).catch(i=>{this.$alert.error(i.response?.data?.message||"Error al crear producto")}).finally(()=>{})},productoPut(){this.loading=!0,this.$axios.put(`productos/${this.producto.id}`,this.producto).then(()=>{this.productoDialog=!1,this.productosGet(),this.$alert.success("Producto actualizado correctamente")}).catch(i=>{this.$alert.error(i.response?.data?.message||"Error al actualizar producto")}).finally(()=>{this.loading=!1})},productoEdit(i){this.producto={...i},this.actionProducto="Editar",this.productoDialog=!0},productoDelete(i){this.$alert.dialog("¿Desea eliminar el producto?").onOk(()=>{this.loading=!0,this.$axios.delete(`productos/${i}`).then(()=>{this.productosGet(),this.$alert.success("Producto eliminado correctamente")}).catch(e=>{this.$alert.error(e.response?.data?.message||"Error al eliminar producto")}).finally(()=>{this.loading=!1})})}}},M={class:"row"},R={class:"col-8 col-md-3"},W={class:"col-4 col-md-2"},Z={class:"col-4 col-md-2 flex flex-center"},j={class:"col-12 col-md-5 text-right"},H={class:"row"},J={class:"col-12 flex flex-center"},K={class:"text-bold text-sub"},X={class:"text-right"};function Y(i,e,P,v,l,s){return n(),u(F,{class:"q-pa-md"},{default:a(()=>[o(x,{flat:"",bordered:""},{default:a(()=>[o(Q,null,{default:a(()=>[o(D,{onSubmit:s.productosGet},{default:a(()=>[r("div",M,[r("div",R,[o(p,{modelValue:l.filter,"onUpdate:modelValue":e[0]||(e[0]=t=>l.filter=t),label:"Buscar",outlined:"",dense:"",clearable:""},{prepend:a(()=>[o(m,{name:"search"})]),_:1},8,["modelValue"])]),r("div",W,[o(w,{modelValue:l.filterTipo,"onUpdate:modelValue":e[1]||(e[1]=t=>l.filterTipo=t),label:"Tipo",outlined:"",dense:"",options:l.tipos},null,8,["modelValue","options"])]),r("div",Z,[o(g,{color:"primary",label:"Buscar",type:"submit","no-caps":"",icon:"search",loading:l.loading},null,8,["loading"])]),r("div",j,[o(g,{color:"positive",label:"Nuevo",onClick:s.productoNew,"no-caps":"",icon:"add_circle_outline",loading:l.loading},null,8,["onClick","loading"])])])]),_:1},8,["onSubmit"]),r("div",H,[r("div",J,[l.totalPages>1?(n(),u(N,{key:0,modelValue:l.currentPage,"onUpdate:modelValue":[e[2]||(e[2]=t=>l.currentPage=t),s.productosGet],max:l.totalPages,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max","onUpdate:modelValue"])):y("",!0)])]),o(z,{dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[e[17]||(e[17]=r("thead",{class:"bg-black text-white"},[r("tr",null,[r("td",null,"Opciones"),r("td",null,"Codigo"),r("td",null,"Nombre"),r("td",null,"Imagen"),r("td",null,"Precio Compra"),r("td",null,"Precio Venta"),r("td",null,"Stock"),r("td",null,"Tipo")])],-1)),r("tbody",null,[(n(!0),_(I,null,T(l.productos,t=>(n(),_("tr",{key:t.id},[r("td",null,[o(S,{dense:"",size:"10px",label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"orange",loading:l.loading},{default:a(()=>[o(G,null,{default:a(()=>[b((n(),u(C,{clickable:"",onClick:h=>s.productoEdit(t)},{default:a(()=>[o(d,{avatar:""},{default:a(()=>[o(m,{name:"edit"})]),_:1}),o(d,null,{default:a(()=>e[13]||(e[13]=[f("Editar")])),_:1})]),_:2},1032,["onClick"])),[[V],[k]]),b((n(),u(C,{clickable:"",onClick:h=>s.productoDelete(t.id)},{default:a(()=>[o(d,{avatar:""},{default:a(()=>[o(m,{name:"delete"})]),_:1}),o(d,null,{default:a(()=>e[14]||(e[14]=[f("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[V],[k]]),b((n(),u(C,{clickable:"",onClick:h=>s.verImagen(t.imagen)},{default:a(()=>[o(d,{avatar:""},{default:a(()=>[o(m,{name:"image"})]),_:1}),o(d,null,{default:a(()=>e[15]||(e[15]=[f("Ver Imagen")])),_:1})]),_:2},1032,["onClick"])),[[V],[k]]),b((n(),u(C,{clickable:"",onClick:h=>s.cambiarImagen(t.id)},{default:a(()=>[o(d,{avatar:""},{default:a(()=>[o(m,{name:"photo_camera"})]),_:1}),o(d,null,{default:a(()=>e[16]||(e[16]=[f("Cambiar Imagen")])),_:1})]),_:2},1032,["onClick"])),[[V],[k]])]),_:2},1024)]),_:2},1032,["loading"])]),r("td",null,c(t.codigo),1),r("td",null,c(t.nombre),1),r("td",null,[t.imagen?(n(),u(q,{key:0,onClick:h=>s.verImagen(t.imagen),src:`${i.$url}uploads/${t.imagen}`,style:{width:"35px",height:"35px"},class:"q-mb-sm"},null,8,["onClick","src"])):y("",!0)]),r("td",null,c(t.precioCompra),1),r("td",null,c(t.precioVenta),1),r("td",null,c(t.stock),1),r("td",null,[o(B,{dense:"",color:s.getColor(t.tipo),size:"10px"},{default:a(()=>[f(c(t.tipo),1)]),_:2},1032,["color"])])]))),128))])]),_:1})]),_:1})]),_:1}),o(E,{modelValue:l.productoDialog,"onUpdate:modelValue":e[12]||(e[12]=t=>l.productoDialog=t),persistent:"",position:"right",maximized:""},{default:a(()=>[o(x,{style:{"min-width":"350px"}},{default:a(()=>[o(Q,{class:"q-pb-none row items-center"},{default:a(()=>[r("div",K,c(l.actionProducto)+" Producto ",1),o(L),o(g,{icon:"close",flat:"",round:"",dense:"",onClick:e[3]||(e[3]=t=>l.productoDialog=!1)})]),_:1}),o(Q,null,{default:a(()=>[o(D,{onSubmit:e[11]||(e[11]=U(t=>l.producto.id?s.productoPut():s.productoPost(),["prevent"]))},{default:a(()=>[o(p,{modelValue:l.producto.codigo,"onUpdate:modelValue":e[4]||(e[4]=t=>l.producto.codigo=t),label:"Codigo",outlined:"",dense:"",hint:""},null,8,["modelValue"]),o(p,{modelValue:l.producto.nombre,"onUpdate:modelValue":e[5]||(e[5]=t=>l.producto.nombre=t),label:"Nombre",outlined:"",dense:"",hint:""},null,8,["modelValue"]),o(p,{modelValue:l.producto.precioCompra,"onUpdate:modelValue":e[6]||(e[6]=t=>l.producto.precioCompra=t),label:"Precio Compra",outlined:"",dense:"",type:"number",step:"0.01",hint:""},null,8,["modelValue"]),o(p,{modelValue:l.producto.precioVenta,"onUpdate:modelValue":e[7]||(e[7]=t=>l.producto.precioVenta=t),label:"Precio Venta",outlined:"",dense:"",type:"number",step:"0.01",hint:""},null,8,["modelValue"]),o(p,{modelValue:l.producto.stock,"onUpdate:modelValue":e[8]||(e[8]=t=>l.producto.stock=t),label:"Stock",outlined:"",dense:"",type:"number",hint:""},null,8,["modelValue"]),o(w,{modelValue:l.producto.tipo,"onUpdate:modelValue":e[9]||(e[9]=t=>l.producto.tipo=t),label:"Tipo",outlined:"",dense:"",options:l.tipos,hint:""},null,8,["modelValue","options"]),r("div",X,[o(g,{color:"negative",label:"Cancelar",onClick:e[10]||(e[10]=t=>l.productoDialog=!1),"no-caps":"",loading:l.loading},null,8,["loading"]),o(g,{color:"primary",label:"Guardar",type:"submit","no-caps":"",class:"q-ml-sm",loading:l.loading},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ge=A(O,[["render",Y]]);export{ge as default};

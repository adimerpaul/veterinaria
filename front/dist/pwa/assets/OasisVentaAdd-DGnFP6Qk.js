import{g as F,r as d,k as S,V as A,c as E,o as c,w as n,b as e,a,f as u,Q as k,e as w,aq as M,an as f,a0 as b,a2 as U,a3 as $,t as s,Z as B,W as Q,aU as I,h as D,ap as L}from"./index-TGOdPL2T.js";import{Q as O}from"./QForm-DFwm7Ss5.js";import{Q as R}from"./QChip-BZDzISse.js";import{Q as q}from"./QMarkupTable-voFnx_-2.js";import{Q as W}from"./QPage-DcuddBdw.js";import{C as Z}from"./ClosePopup-Dk18tChr.js";import{I as j}from"./Imprimir-fv9SlmQn.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./moment-C5S46NFB.js";const G={class:"row"},H={class:"col-12"},J={class:"col-12 col-md-7"},K={class:"row"},X={class:"col-12 col-md-7"},Y={class:"col-12 col-md-2 flex flex-center"},ee=["onClick"],le={class:"text-right"},te={class:"col-12 col-md-5"},ae=["onUpdate:modelValue"],oe=["onUpdate:modelValue"],ne={class:"text-right"},se={class:"text-bold text-right"},re={class:"row"},de={class:"col-12"},xe={__name:"OasisVentaAdd",setup(ue){const{proxy:i}=F(),V=d(""),P=d([]),r=d([]),m=d(!1),p=d(!1),g=d(""),x=d(""),h=d(""),C=S(()=>r.value.reduce((o,l)=>o+l.cantidadVenta*l.precioVenta,0).toFixed(2));function T(o){switch(o){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function y(){i.$axios.get("/oasis-productos",{params:{filter:V.value}}).then(o=>{P.value=o.data.data})}function z(o){const l=r.value.find(t=>t.id===o.id);l?l.cantidadVenta++:r.value.push({...o,cantidadVenta:1})}function N(){if(r.value.length===0){i.$alert.error("El carrito está vacío");return}m.value=!0,i.$axios.post("/oasis-sales",{productos:r.value,total:parseFloat(C.value),ci:g.value,nombre:x.value,comentario:h.value}).then(o=>{i.$alert.success("Venta registrada"),j.notaOasisVenta(o.data),r.value=[],y(),p.value=!1}).catch(o=>{i.$alert.error(o.response?.data?.message||"Error al registrar venta")}).finally(()=>{m.value=!1})}return A(()=>{y()}),(o,l)=>(c(),E(W,{class:"q-pa-xs"},{default:n(()=>[e("div",G,[e("div",H,[a(u,{label:"Atras",color:"primary",onClick:l[0]||(l[0]=t=>o.$router.push("/oasis-ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),e("div",J,[a(k,{flat:"",bordered:"",class:"q-ma-xs"},{default:n(()=>[a(w,null,{default:n(()=>[a(O,{onSubmit:M(y,["prevent"])},{default:n(()=>[e("div",K,[e("div",X,[a(f,{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=t=>V.value=t),label:"Buscar oasis producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",Y,[a(u,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),a(q,{dense:"",bordered:"",flat:""},{default:n(()=>[l[7]||(l[7]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Stock")])],-1)),e("tbody",null,[(c(!0),b(U,null,$(P.value,t=>(c(),b("tr",{key:t.id,onClick:_=>z(t),style:{cursor:"pointer"}},[e("td",null,s(t.codigo),1),e("td",null,s(t.nombre),1),e("td",null,[a(R,{dense:"",color:T(t.tipo),size:"10px"},{default:n(()=>[B(s(t.tipo),1)]),_:2},1032,["color"])]),e("td",le,s(t.precioVenta),1),e("td",null,s(t.stock),1)],8,ee))),128))])]),_:1})]),_:1})]),_:1})]),e("div",te,[a(k,{flat:"",bordered:"",class:"q-ma-xs"},{default:n(()=>[a(w,null,{default:n(()=>[l[11]||(l[11]=e("div",{class:"text-h6"},"Carrito",-1)),a(q,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:n(()=>[l[10]||(l[10]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cant"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th")])],-1)),e("tbody",null,[(c(!0),b(U,null,$(r.value,(t,_)=>(c(),b("tr",{key:_},[e("td",null,s(t.nombre),1),e("td",null,[Q(e("input",{"onUpdate:modelValue":v=>t.cantidadVenta=v,type:"number",min:"1",style:{width:"50px"}},null,8,ae),[[I,t.cantidadVenta,void 0,{number:!0}]])]),e("td",null,[Q(e("input",{"onUpdate:modelValue":v=>t.precioVenta=v,type:"number",step:"0.01",style:{width:"70px"}},null,8,oe),[[I,t.precioVenta,void 0,{number:!0}]])]),e("td",ne,s((t.cantidadVenta*t.precioVenta).toFixed(2)),1),e("td",null,[a(u,{icon:"delete",dense:"",color:"red",size:"10px",onClick:v=>r.value.splice(_,1)},null,8,["onClick"])])]))),128))]),e("tfoot",null,[e("tr",null,[l[8]||(l[8]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",se,s(C.value)+" Bs",1),l[9]||(l[9]=e("td",null,null,-1))])])]),_:1}),a(u,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-sm",onClick:l[2]||(l[2]=t=>p.value=!0),loading:m.value,"no-caps":""},null,8,["loading"])]),_:1})]),_:1})])]),a(D,{modelValue:p.value,"onUpdate:modelValue":l[6]||(l[6]=t=>p.value=t)},{default:n(()=>[a(k,{style:{width:"400px"}},{default:n(()=>[a(w,null,{default:n(()=>[l[13]||(l[13]=e("div",{class:"text-h6"},"Confirmar Venta",-1)),e("div",re,[e("div",de,[a(f,{modelValue:g.value,"onUpdate:modelValue":l[3]||(l[3]=t=>g.value=t),label:"CI",outlined:"",dense:"",hint:"Ingrese CI ",rules:[t=>t.length>=5||"CI debe tener al menos 5 caracteres"]},null,8,["modelValue","rules"]),a(f,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=t=>x.value=t),label:"Nombre ",outlined:"",dense:"",hint:"Ingrese nombre ",rules:[t=>t.length>0||"Nombre es requerido"]},null,8,["modelValue","rules"]),a(f,{modelValue:h.value,"onUpdate:modelValue":l[5]||(l[5]=t=>h.value=t),label:"Comentario ",outlined:"",dense:"",hint:"",type:"textarea"},null,8,["modelValue"])])]),e("div",null,[l[12]||(l[12]=B("Total: ")),e("strong",null,s(C.value)+" Bs",1)])]),_:1}),a(L,{align:"right"},{default:n(()=>[Q(a(u,{flat:"",label:"Cancelar",color:"primary"},null,512),[[Z]]),a(u,{label:"Confirmar",color:"positive",onClick:N,loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l[14]||(l[14]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1}))}};export{xe as default};

import{aR as ve,g as fe,r as i,V as ge,k as be,a0 as p,o as d,a as t,b as e,w as r,f as m,Q as T,e as V,aq as I,an as _,aS as Ve,u as M,c as J,a1 as Y,a2 as x,a3 as y,t as n,Z as Q,W as K,aT as X,h as A,ao as xe,a8 as he,ap as _e}from"./index-BQzGckS2.js";import{Q as q}from"./QSelect-Br2Kbmgp.js";import{Q as L}from"./QForm-BtWW1RqC.js";import{Q as ye}from"./QPagination-DjgLcZee.js";import{Q as ee}from"./QChip-CDkvs-uL.js";import{Q as P}from"./QMarkupTable-DmwAH9JT.js";import{Q as O}from"./QSpace-CJNtNJot.js";import{Q as Ce}from"./QPage-BJWwXlpo.js";import{I as we}from"./Imprimir-CDKy_aPn.js";import{h as le}from"./moment-C5S46NFB.js";import"./QMenu-MVBF9-Pt.js";import"./QItemLabel-CIraevKe.js";import"./format-DyQxkAtJ.js";import"./numeroaletras-C3tYt5BD.js";import"./_commonjsHelpers-D6-XlEtG.js";const ke={class:"row"},$e={class:"col-12"},Te={class:"col-12 col-md-7"},Qe={class:"row"},Pe={class:"col-12 col-md-7"},De={class:"col-12 col-md-3"},Se={class:"col-12 col-md-2 flex flex-center"},Ue={class:"row"},Me={class:"col-12 flex flex-center"},qe=["onClick"],ze={class:"text-right"},Be={class:"col-12 col-md-5"},Ee={class:"div"},Fe={class:"text-h6 row items-center"},Ne={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},Re=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],Ye={class:"text-right"},Ae={class:"text-bold text-right"},Le={class:"row"},Oe={class:"col-12 q-pa-xs"},Ge={class:"row"},He={class:"col-6"},je={class:"col-2 text-center"},We={class:"col-2 flex flex-center"},Ze={class:"col-2 flex flex-center"},Je={class:"col-12"},Ke={class:"col-12"},Xe={class:"text-right"},el={class:"text-right"},ll={class:"text-bold text-right"},al={class:"col-12 q-pa-xs"},tl={key:0,class:"col-12"},ol={style:{"max-width":"150px","wrap-option":"wrap","line-height":"0.9"}},nl={class:"text-caption q-mt-md"},rl={style:{"max-width":"150px","white-space":"normal","line-height":"0.9"}},sl={style:{"max-width":"200px","white-space":"normal","line-height":"1.2"}},il={class:"row q-col-gutter-md"},dl={class:"col-6"},ul={class:"col-6"},cl={class:"col-6"},pl={class:"col-6"},ml={class:"col-12"},Dl={__name:"VentaAdd",setup(vl){const ae=ve(),{proxy:s}=fe(),h=i({nombre:"",fecha:new Date().toISOString().slice(0,10)}),G=i([]);i([]);const v=i([]);let w=i("");const D=i(!1),c=i(!1),z=i(1),B=i(1),S=i("Todos"),te=["Todos","Cirugía","Laboratorio","Peluqueria","Producto","Tratamiento"],U=i([]),E=i([]),b=i(null),k=i(!1),C=i(le().format("YYYY-MM-DD")),H=i([]),$=i(!1);ge(()=>{F(),W()});const f=i({nombre:"",especie:"",propietario_nombre:"",propietario_telefono:"",propietario_ciudad:"Oruro"}),oe=i(["Oruro","La Paz","Santa Cruz","Cochabamba","Sucre","Tarija","Potosí","Beni","Pando","Chuquisaca"]);async function ne(){try{c.value=!0;const o=await s.$axios.post("/mascotas",f.value);s.$alert.success("Mascota registrada correctamente"),$.value=!1,await W(),b.value=o.data,f.value={nombre:"",especie:"",propietario_nombre:"",propietario_telefono:"",propietario_ciudad:"Oruro"}}catch{s.$alert.error("No se pudo registrar la mascota")}finally{c.value=!1}}function re(o){if(!o?.tratamientoMedicamentos||o.tratamientoMedicamentos.length===0){s.$alert.error("Este tratamiento no tiene medicamentos.");return}s.$axios.put(`tratamientos/pagado/${o.id}`,{pagado:!0}).then(()=>{}).catch(a=>{s.$alert.error("Error al marcar el tratamiento como pagado.")}),o.tratamientoMedicamentos.forEach(a=>{const l=v.value.find(g=>g.nombre===a.medicamento);l?l.cantidadVenta+=a.cantidad:v.value.push({id:a.producto?.id,nombre:a.medicamento,cantidadVenta:parseInt(a.cantidad),precioVenta:a.precio,tipo:"Tratamiento"})}),s.$alert.success("Tratamiento agregado al carrito."),k.value=!1}function j(){if(!C.value){s.$alert.error("Seleccione una fecha","Error");return}c.value=!0,s.$axios.get("tratamientos",{params:{fecha:C.value}}).then(o=>{H.value=o.data}).finally(()=>{c.value=!1})}function se(){k.value=!0,C.value=le().format("YYYY-MM-DD"),j()}function W(){s.$axios.get("mascotas",{params:{filter:""}}).then(o=>{U.value=o.data.data})}function ie(){console.log(b.value),c.value=!0,s.$axios.post("mascotas/historial",{mascotaId:b.value.id}).then(o=>{console.log(o.data),E.value=o.data}).finally(()=>{c.value=!1})}function Z(o){switch(o){case"Cirugía":return"red";case"Laboratorio":return"blue";case"Peluqueria":return"green";case"Producto":return"orange";case"Tratamiento":return"purple";default:return"grey"}}function F(){s.$axios.get("/productos",{params:{filter:w.value,page:z.value,limit:20,tipo:S.value==="Todos"?"":S.value}}).then(o=>{G.value=o.data.data,B.value=o.data.last_page})}const N=be(()=>v.value.reduce((o,a)=>o+a.cantidadVenta*a.precioVenta,0).toFixed(2));function de(o){const a=v.value.find(l=>l.id===o.id);a?a.cantidadVenta++:v.value.push({...o,cantidadVenta:1,precioVenta:o.precioVenta})}function ue(o){v.value.splice(o,1)}function ce(){if(v.value.length===0){s.$alert.error("El carrito está vacío","Error");return}D.value=!0,h.value={comentarioDoctor:"",pago:"Efectivo"},b.value={id:1,nombre:"SN",propietario_nombre:"SN"}}function pe(o,a){if(o===""){a(()=>{s.$axios.get("mascotas",{params:{filter:""}}).then(l=>{U.value=l.data.data})});return}a(()=>{s.$axios.get("mascotas",{params:{filter:o}}).then(l=>{U.value=l.data.data})})}function me(){if(v.value.length===0){s.$alert.error("El carrito está vacío");return}c.value=!0,s.$axios.post("/sales",{mascota:b.value,total:parseFloat(N.value),productos:v.value,comentarioDoctor:h.value.comentarioDoctor,pago:h.value.pago}).then(async o=>{s.$alert.success("Venta realizada con éxito","Éxito"),ae.push("/ventas"),we.nota(o.data.sale)}).catch(o=>{s.$alert.error(o.response.data.message,"Error")}).finally(()=>{c.value=!1})}return(o,a)=>(d(),p(x,null,[t(Ce,{class:"q-pa-xs"},{default:r(()=>[e("div",ke,[e("div",$e,[t(m,{label:"Atras",color:"primary",onClick:a[0]||(a[0]=l=>o.$router.push("/ventas")),"no-caps":"",icon:"arrow_back",size:"10px"})]),e("div",Te,[t(T,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(V,null,{default:r(()=>[t(L,{onSubmit:I(F,["prevent"])},{default:r(()=>[e("div",Qe,[e("div",Pe,[t(_,{modelValue:M(w),"onUpdate:modelValue":a[1]||(a[1]=l=>Ve(w)?w.value=l:w=l),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",De,[t(q,{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=l=>S.value=l),label:"Tipo",outlined:"",dense:"",options:te},null,8,["modelValue"])]),e("div",Se,[t(m,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),e("div",Ue,[e("div",Me,[B.value>1?(d(),J(ye,{key:0,modelValue:z.value,"onUpdate:modelValue":[a[3]||(a[3]=l=>z.value=l),F],max:B.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):Y("",!0)])]),t(P,{dense:"",bordered:"",flat:""},{default:r(()=>[a[21]||(a[21]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Stock")])],-1)),e("tbody",null,[(d(!0),p(x,null,y(G.value,l=>(d(),p("tr",{onClick:g=>de(l),key:l.id,style:{cursor:"pointer"}},[e("td",null,n(l.codigo),1),e("td",null,n(l.nombre),1),e("td",null,[t(ee,{dense:"",color:Z(l.tipo),size:"10px"},{default:r(()=>[Q(n(l.tipo),1)]),_:2},1032,["color"])]),e("td",ze,n(l.precioVenta),1),e("td",null,n(l.stock),1)],8,qe))),128))])]),_:1})]),_:1})]),_:1})]),e("div",Be,[t(T,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(V,null,{default:r(()=>[e("div",Ee,[e("div",Fe,[e("div",null,[a[22]||(a[22]=Q(" Carrito ")),t(m,{icon:"history",color:"blue",dense:"",onClick:se,loading:c.value,size:"10px",label:"Recuperar Tratamiento","no-caps":""},null,8,["loading"])]),t(O),t(m,{icon:"delete",color:"red",dense:"",onClick:a[4]||(a[4]=l=>v.value=[]),loading:c.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),a[23]||(a[23]=e("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),t(P,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[a[26]||(a[26]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Precio"),e("th",null,"Subtotal"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(d(!0),p(x,null,y(v.value,(l,g)=>(d(),p("tr",{key:g},[e("td",null,[e("div",Ne,n(l.nombre),1)]),e("td",null,[K(e("input",{"onUpdate:modelValue":u=>l.cantidadVenta=u,type:"number",style:{width:"50px"},min:"1"},null,8,Re),[[X,l.cantidadVenta,void 0,{number:!0}]])]),e("td",null,[K(e("input",{"onUpdate:modelValue":u=>l.precioVenta=u,type:"number",style:{width:"80px"},min:"1",step:"0.1"},null,8,Ie),[[X,l.precioVenta,void 0,{number:!0}]])]),e("td",Ye,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1),e("td",null,[t(m,{icon:"delete",color:"red",dense:"",onClick:u=>ue(g),loading:c.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),e("tfoot",null,[e("tr",null,[a[24]||(a[24]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",Ae,n(N.value)+" Bs",1),a[25]||(a[25]=e("td",null,null,-1))])])]),_:1}),t(m,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:ce,loading:c.value},null,8,["loading"])]),_:1})]),_:1})])]),t(A,{modelValue:D.value,"onUpdate:modelValue":a[10]||(a[10]=l=>D.value=l)},{default:r(()=>[t(T,{flat:"",bordered:"",style:{"max-width":"750px"}},{default:r(()=>[t(V,{class:"q-pb-none row items-center"},{default:r(()=>[a[27]||(a[27]=e("div",{class:"text-bold"}," Realizar Venta ",-1)),t(O),t(m,{flat:"",dense:"",round:"",icon:"close",onClick:a[5]||(a[5]=l=>D.value=!1)})]),_:1}),t(V,null,{default:r(()=>[t(L,{onSubmit:I(me,["prevent"])},{default:r(()=>[e("div",Le,[e("div",Oe,[e("div",Ge,[e("div",He,[t(q,{"input-debounce":"300",clearable:"","use-input":"",modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=l=>b.value=l),label:"Mascota",outlined:"",dense:"",options:U.value,"option-label":l=>l.id+"|"+l.nombre+"|"+l.propietario_nombre,"option-value":l=>l.id,onFilter:pe,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","option-label","option-value","rules"])]),e("div",je,[t(q,{modelValue:h.value.pago,"onUpdate:modelValue":a[7]||(a[7]=l=>h.value.pago=l),label:"Pago",outlined:"",dense:"",options:["Efectivo","Qr","Transferencia"],hint:""},null,8,["modelValue"])]),e("div",We,[t(m,{dense:"",color:"green",label:"Crear","no-caps":"",icon:"add_circle_outline",onClick:a[8]||(a[8]=l=>$.value=!0)})]),e("div",Ze,[b.value?(d(),J(m,{key:0,loading:c.value,dense:"",color:"blue",label:"historial","no-caps":"",icon:"history",onClick:ie},null,8,["loading"])):Y("",!0)])])]),e("div",Je,[t(_,{modelValue:h.value.comentarioDoctor,"onUpdate:modelValue":a[9]||(a[9]=l=>h.value.comentarioDoctor=l),label:"Comentario Doctor",outlined:"",dense:"",type:"textarea",rows:"2"},null,8,["modelValue"])]),e("div",Ke,[t(P,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[a[29]||(a[29]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Producto"),e("th",null,"Cantidad"),e("th",null,"Tipo"),e("th",null,"Precio"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(d(!0),p(x,null,y(v.value,(l,g)=>(d(),p("tr",{key:g},[e("td",null,n(l.nombre),1),e("td",null,n(l.cantidadVenta),1),e("td",null,[t(ee,{dense:"",color:Z(l.tipo),size:"10px"},{default:r(()=>[Q(n(l.tipo),1)]),_:2},1032,["color"])]),e("td",Xe,n(l.precioVenta)+" Bs",1),e("td",el,n((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1)]))),128))]),e("tfoot",null,[e("tr",null,[a[28]||(a[28]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",ll,n(N.value)+" Bs",1)])])]),_:1})]),e("div",al,[t(m,{label:"Realizar Venta",color:"positive",class:"full-width",type:"submit","no-caps":"",loading:c.value},null,8,["loading"])]),E.value.length>0?(d(),p("div",tl,[a[32]||(a[32]=e("div",{class:"text-h6 row items-center"}," Historial de Compras ",-1)),t(P,{flat:"",bordered:"",dense:""},{default:r(()=>[a[31]||(a[31]=e("thead",null,[e("tr",null,[e("td",null,"#"),e("td",null,"Fecha"),e("td",null,"Total"),e("td",null,"Anulado"),e("td",null,"Detalles")])],-1)),e("tbody",null,[(d(!0),p(x,null,y(E.value,(l,g)=>(d(),p("tr",{key:g},[e("td",null,n(l.id),1),e("td",null,n(l.fecha.slice(0,10)),1),e("td",null,n(l.total),1),e("td",null,n(l.anulado?"Si":"No"),1),e("td",null,[e("div",ol,[(d(!0),p(x,null,y(l.details,(u,R)=>(d(),p("span",{key:R},[Q(n(u.productoName)+" ("+n(u.cantidad)+")",1),a[30]||(a[30]=e("br",null,null,-1))]))),128))])])]))),128))])]),_:1})])):Y("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{modelValue:k.value,"onUpdate:modelValue":a[13]||(a[13]=l=>k.value=l)},{default:r(()=>[t(T,{flat:"",bordered:"",style:{"min-width":"600px","max-width":"90vw"}},{default:r(()=>[t(V,{class:"q-pb-none row items-center"},{default:r(()=>[a[33]||(a[33]=e("div",{class:"text-bold"}," Recuperar Tratamiento ",-1)),t(O),t(m,{flat:"",dense:"",round:"",icon:"close",onClick:a[11]||(a[11]=l=>k.value=!1)})]),_:1}),t(V,null,{default:r(()=>[a[36]||(a[36]=e("div",{class:"text-caption"},"Seleccione una fecha para recuperar el tratamiento",-1)),t(_,{modelValue:C.value,"onUpdate:modelValue":a[12]||(a[12]=l=>C.value=l),type:"date",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},{append:r(()=>[t(m,{dense:"",color:"green",label:"Buscar","no-caps":"",icon:"search",onClick:j,loading:c.value},null,8,["loading"])]),_:1},8,["modelValue","rules"]),e("div",nl," Tratamientos realizados el "+n(C.value)+": ",1),t(P,{flat:"",bordered:"",dense:""},{default:r(()=>[a[35]||(a[35]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Fecha"),e("th",null,"Doctor"),e("th",null,"Mascota"),e("th",null,"Costo"),e("th",null,"Medicamentos"),e("th",null,"Opciones"),e("th",null,"Pagado")])],-1)),e("tbody",null,[(d(!0),p(x,null,y(H.value,(l,g)=>(d(),p("tr",{key:g},[e("td",null,n(l.id),1),e("td",null,n(l.fecha.slice(0,10)),1),e("td",null,n(l.user?.username||"Desconocido"),1),e("td",null,[e("div",rl,n(l.historiale?.mascota?.nombre||"Desconocido")+" ("+n(l.historiale?.mascota?.propietario_nombre||"Desconocido")+") ",1)]),e("td",null,n(l.costo)+" Bs",1),e("td",null,[e("div",sl,[(d(!0),p(x,null,y(l.tratamientoMedicamentos,(u,R)=>(d(),p("span",{key:R},[Q(n(u.medicamento)+" ("+n(u.cantidad)+" x "+n(u.precio)+" Bs) ",1),a[34]||(a[34]=e("br",null,null,-1))]))),128))])]),e("td",null,[t(m,{label:"Recuperar","no-caps":"",dense:"",color:"green",icon:"add_circle_outline",size:"10px",onClick:u=>re(l)},null,8,["onClick"])]),e("td",null,[t(xe,{modelValue:l.pagado,"onUpdate:modelValue":[u=>l.pagado=u,u=>{M(s).$axios.put(`tratamientos/pagado/${l.id}`,{pagado:u}).then(()=>{M(s).$alert.success(`Tratamiento ${u?"marcado como pagado":"desmarcado como pagado"}.`)}).catch(()=>{M(s).$alert.error("Error al actualizar el estado del tratamiento.")})}],"true-value":!0,"false-value":!1,color:"green",size:"20px"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(A,{modelValue:$.value,"onUpdate:modelValue":a[20]||(a[20]=l=>$.value=l),persistent:""},{default:r(()=>[t(T,{style:{width:"800px","max-width":"90vw"}},{default:r(()=>[t(V,null,{default:r(()=>a[37]||(a[37]=[e("div",{class:"text-h6"},"Registrar Mascota",-1)])),_:1}),t(he),t(V,null,{default:r(()=>[t(L,{onSubmit:I(ne,["prevent"])},{default:r(()=>[e("div",il,[e("div",dl,[t(_,{modelValue:f.value.nombre,"onUpdate:modelValue":a[14]||(a[14]=l=>f.value.nombre=l),label:"Nombre",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),e("div",ul,[t(_,{modelValue:f.value.propietario_nombre,"onUpdate:modelValue":a[15]||(a[15]=l=>f.value.propietario_nombre=l),label:"Propietario",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])]),e("div",cl,[t(_,{modelValue:f.value.propietario_telefono,"onUpdate:modelValue":a[16]||(a[16]=l=>f.value.propietario_telefono=l),label:"Teléfono",outlined:"",dense:""},null,8,["modelValue"])]),e("div",pl,[t(q,{modelValue:f.value.propietario_ciudad,"onUpdate:modelValue":a[17]||(a[17]=l=>f.value.propietario_ciudad=l),label:"Ciudad",outlined:"",dense:"",options:oe.value},null,8,["modelValue","options"])]),e("div",ml,[t(_,{modelValue:f.value.especie,"onUpdate:modelValue":a[18]||(a[18]=l=>f.value.especie=l),label:"Especie",outlined:"",dense:""},null,8,["modelValue"])])]),t(_e,{align:"right",class:"q-mt-md"},{default:r(()=>[t(m,{flat:"",label:"Cancelar",color:"negative",onClick:a[19]||(a[19]=l=>$.value=!1)}),t(m,{label:"Guardar",type:"submit",color:"positive",loading:c.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[38]||(a[38]=e("div",{id:"myElement"},null,-1))],64))}};export{Dl as default};

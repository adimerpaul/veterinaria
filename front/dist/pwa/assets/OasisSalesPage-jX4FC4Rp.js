import{g as W,r as i,V as Z,a0 as m,o as n,a as l,b as t,w as a,Q as q,e as $,aq as E,an as h,c as v,a1 as V,f as C,W as w,$ as y,t as d,Z as b,_ as k,a2 as B,a3 as T,a8 as G,h as K}from"./index-ZqKPYtQ-.js";import{Q as X}from"./QSelect-C4c7JAv-.js";import{Q as j}from"./QForm-C4b3eEVO.js";import{Q,a as u}from"./QMenu-jXd2p4xe.js";import{Q as p}from"./QItemLabel-D15F-gZG.js";import{a as F,Q as ee}from"./QList-c2vE5jEG.js";import{Q as le}from"./QChip-CasoMmNh.js";import{Q as ae}from"./QMarkupTable-B03ELB8c.js";import{Q as oe}from"./QPage-CNAbIifY.js";import{Q as te}from"./QSpace-DvJH2X_N.js";import{C as L}from"./ClosePopup-v7peCh0V.js";import{h as N}from"./moment-C5S46NFB.js";import{I as se}from"./Imprimir-DyH9MEj2.js";import{E as ne}from"./Excel-CKQ98bqC.js";import"./format-DyQxkAtJ.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const ie={class:"row"},de={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ue={class:"col-12 col-md-2"},ce={class:"col-12 col-md-2 flex flex-center"},me={class:"col-12 col-md-2 flex flex-center"},fe={class:"col-12 col-md-4"},pe={class:"col-12 col-md-2 flex flex-center"},ve={class:"row"},be={key:0,class:"col-12 col-md-4 q-pa-xs"},xe={class:"text-weight-bold"},_e={key:1,class:"col-12 col-md-4 q-pa-xs"},ge={class:"text-weight-bold"},he={key:2,class:"col-12 col-md-4 q-pa-xs"},Ve={class:"text-weight-bold"},Ce={key:1},we={class:"text-right"},ye={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},ke={style:{"max-width":"350px","wrap-option":"wrap","line-height":"0.9"}},Pe={__name:"OasisSalesPage",setup(Qe){const{proxy:x}=W(),A=i(N().format("YYYY-MM-DD")),S=i(N().format("YYYY-MM-DD")),f=i([]),Y=i([]),r=i(!1),_=i(""),U=i([]),I=i("");i("CAJA");const D=i(!1),g=i({});i([]),i(["CAJA","PRODUCTOS"]),Z(()=>{M(),z()});function O(){r.value=!0,x.$axios.post("/cajas",g.value).then(s=>{D.value=!1,x.$alert.success("Registrado correctamente",s.data)}).finally(()=>{r.value=!1})}function P(){if(!_.value){f.value=Y.value;return}f.value=Y.value.filter(s=>s.nombre.toLowerCase().includes(_.value.toLowerCase())||s.user?.name.toLowerCase().includes(_.value.toLowerCase()))}function H(s){console.log(s);const e={sale:s,detalles:s.oasisSalesDetalles};se.notaOasisVenta(e)}function R(){const s=[{sheet:"Ventas",columns:[{label:"Fecha",value:e=>N(e.fecha).format("DD/MM/YYYY HH:mm")},{label:"Cliente",value:e=>e.nombre},{label:"Mascota",value:e=>e.mascota?.nombre},{label:"Usuario",value:e=>e.user?.username},{label:"Total",value:e=>e.total},{label:"Comentario Doctor",value:e=>e.comentarioDoctor},{label:"Detalles",value:e=>e.details.map(o=>`${o.cantidad} ${o.productoName}`).join(", ")}],content:f.value.map(e=>({fecha:e.fecha,nombre:e.nombre,mascota:e.mascota,user:e.user,total:e.total,comentarioDoctor:e.comentarioDoctor,details:e.details}))}];ne.export(s,"Ventas")}function J(s){x.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{r.value=!0,x.$axios.post(`/oasis-sales/${s}/anular`).then(()=>{M()}).finally(()=>{r.value=!1})})}function z(){U.value=[{id:"",name:"Todos"}],x.$axios.get("/users").then(s=>{s.data.forEach(e=>{U.value.push({id:e.id,name:e.name})})})}function M(){r.value=!0,x.$axios.get("/oasis-sales",{params:{fechaInicio:A.value,fechaFin:S.value,user_id:I.value}}).then(s=>{f.value=s.data,Y.value=s.data}).finally(()=>{r.value=!1})}return(s,e)=>(n(),m(B,null,[l(oe,{class:"q-pa-xs"},{default:a(()=>[l(q,{flat:"",bordered:""},{default:a(()=>[l($,{class:"q-pa-xs"},{default:a(()=>[l(j,{onSubmit:E(M,["prevent"])},{default:a(()=>[t("div",ie,[t("div",de,[l(h,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=o=>A.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",re,[l(h,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",ue,[s.$store.user.role==="Admin"?(n(),v(X,{key:0,modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=o=>I.value=o),label:"Usuario",outlined:"",dense:"",options:U.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):V("",!0)]),t("div",ce,[l(C,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:r.value},null,8,["loading"])]),e[9]||(e[9]=t("div",{class:"col-12 col-md-2"},null,-1)),t("div",me,[l(C,{label:"Excel",color:"green",icon:"fa-solid fa-file-excel","no-caps":"",loading:r.value,onClick:R},null,8,["loading"])]),e[10]||(e[10]=t("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),t("div",fe,[l(h,{modelValue:_.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>_.value=o),P],label:"Filtro",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),t("div",pe,[l(C,{style:{width:"150px"},label:"Nueva Venta",color:"positive",onClick:e[4]||(e[4]=o=>s.$router.push("/oasisventas/add")),"no-caps":"",icon:"add_circle_outline",loading:r.value},null,8,["loading"])]),e[11]||(e[11]=t("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),e[12]||(e[12]=t("div",{class:"col-12 col-md-2 flex flex-center"},null,-1))])]),_:1}),t("div",ve,[s.$store.user.role==="Admin"?(n(),m("div",be,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((n(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(y,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",xe,d(f.value.length)+" ventas ",1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[13]||(e[13]=[b(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):V("",!0),s.$store.user.role==="Admin"?(n(),m("div",_e,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((n(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(y,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",ge," Bs "+d(f.value.filter(o=>!o.anulado).reduce((o,c)=>o+parseFloat(c.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[14]||(e[14]=[b(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):V("",!0),s.$store.user.role==="Admin"?(n(),m("div",he,[l(F,{bordered:"",padding:"",dense:""},{default:a(()=>[w((n(),v(Q,{clickable:""},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(y,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(u,null,{default:a(()=>[l(p,{lines:"1"},{default:a(()=>[t("span",Ve," Bs "+d(f.value.filter(o=>o.anulado).reduce((o,c)=>o+parseFloat(c.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:"",lines:"2"},{default:a(()=>e[15]||(e[15]=[b(" Total de ventas anuladas ")])),_:1})]),_:1})]),_:1})),[[k]])]),_:1})])):V("",!0)])]),_:1})]),_:1}),l(q,{flat:"",bordered:"",class:"q-mt-md"},{default:a(()=>[l($,null,{default:a(()=>[l(ae,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:a(()=>[e[19]||(e[19]=t("thead",null,[t("tr",{class:"bg-orange text-white"},[t("th",null,"Acciones"),t("th",null,"Fecha"),t("th",null,"Total"),t("th",null,"Nombre Cliente"),t("th",null,"Usuario"),t("th",null,"Detalle"),t("th",null,"Comentario Doctor")])],-1)),t("tbody",null,[(n(!0),m(B,null,T(f.value,o=>(n(),m("tr",{key:o.id},[t("td",null,[o.anulado?(n(),m("div",Ce,[l(le,{color:"red","text-color":"white",label:"Anulada"})])):(n(),v(ee,{key:0,label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"indigo",size:"10px"},{default:a(()=>[l(F,null,{default:a(()=>[w((n(),v(Q,{clickable:"",onClick:c=>H(o)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(y,{icon:"print"})]),_:1}),l(u,null,{default:a(()=>[l(p,null,{default:a(()=>e[16]||(e[16]=[b("Imprimir")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k],[L]]),l(G),o.anulado?V("",!0):w((n(),v(Q,{key:0,clickable:"",onClick:c=>J(o.id)},{default:a(()=>[l(u,{avatar:""},{default:a(()=>[l(y,{icon:"delete"})]),_:1}),l(u,null,{default:a(()=>[l(p,null,{default:a(()=>e[17]||(e[17]=[b("Anular")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[k],[L]])]),_:2},1024)]),_:2},1024))]),t("td",null,d(s.$filters.dateDmYHis(o.fecha)),1),t("td",we,d(o.total),1),t("td",null,[b(d(o.nombre)+" ",1),e[18]||(e[18]=t("br",null,null,-1)),b(" "+d(o.mascota?.nombre),1)]),t("td",null,d(o.user?.username),1),t("td",null,[t("div",ye,[(n(!0),m(B,null,T(o.oasisSalesDetalles,c=>(n(),m("span",{key:c.id},d(c.cantidad)+" "+d(c.productoName)+", ",1))),128))])]),t("td",null,[t("div",ke,d(o.comentarioDoctor),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(K,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=o=>D.value=o),persistent:""},{default:a(()=>[l(q,{flat:"",bordered:"",style:{width:"350px"}},{default:a(()=>[l($,{class:"row items-center q-pb-none"},{default:a(()=>[e[20]||(e[20]=t("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(te),l(C,{flat:"",dense:"",icon:"close",onClick:e[5]||(e[5]=o=>D.value=!1)})]),_:1}),l($,null,{default:a(()=>[l(j,{onSubmit:E(O,["prevent"])},{default:a(()=>[l(h,{modelValue:g.value.monto_final,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value.monto_final=o),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(h,{type:"textarea",modelValue:g.value.observacion,"onUpdate:modelValue":e[7]||(e[7]=o=>g.value.observacion=o),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(C,{label:"Cerrar Caja",color:"red",type:"submit",loading:r.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[21]||(e[21]=t("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{Pe as default};

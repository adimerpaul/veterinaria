import{g as L,r as i,a1 as P,c as V,o as d,w as o,a as l,Q as q,e as B,a7 as m,a8 as M,aw as S,b as a,at as F,f as Y,a6 as x,a4 as v,t as n,a9 as A,aa as I,J as H}from"./index-CeLS1kfd.js";import{Q as O}from"./QSelect-Cr40Q5mg.js";import{Q as j}from"./QForm-B0DFzUrN.js";import{Q as b,a as c}from"./QMenu-BNcm7Ouo.js";import{Q as p}from"./QItemLabel-B5ElpcAC.js";import{a as g,Q as z}from"./QList-Cy9RETy4.js";import{Q as J}from"./QChip-BQ60xaLu.js";import{Q as G}from"./QMarkupTable-BZbS-C9N.js";import{Q as K}from"./QPage-g5g7VCmC.js";import{C as R}from"./ClosePopup-CpQ_cBxn.js";import{h as $}from"./moment-C5S46NFB.js";import{E as W}from"./Excel-CKQ98bqC.js";import"./format-DyQxkAtJ.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const X={class:"row"},Z={class:"col-12 col-md-2"},ee={class:"col-12 col-md-2"},le={key:0,class:"col-12 col-md-3"},ae={class:"col-12 col-md-2 flex flex-center"},oe={class:"col-12 col-md-2 flex flex-center"},te={class:"col-12 col-md-3 q-mt-sm"},se={class:"col-12 col-md-2 flex flex-center q-mt-sm"},ne={key:0,class:"row q-mt-sm"},de={class:"col-12 col-md-4 q-pa-xs"},re={class:"col-12 col-md-4 q-pa-xs"},ue={class:"col-12 col-md-4 q-pa-xs"},ie={key:1},ce={class:"text-right"},me={style:{"max-width":"350px","line-height":".95"}},pe={style:{"max-width":"350px","line-height":".95"}},De={__name:"Compras",setup(fe){const{proxy:_}=L(),C=i($().format("YYYY-MM-DD")),Q=i($().format("YYYY-MM-DD")),r=i([]),w=i([]),f=i(!1),h=i(""),D=i([{id:"",name:"Todos"}]),y=i("");P(()=>{N(),k()});function N(){_.$axios.get("/users").then(s=>{s.data.forEach(e=>D.value.push({id:e.id,name:e.name}))})}function k(){f.value=!0,_.$axios.get("/purchases",{params:{fechaInicio:C.value,fechaFin:Q.value,user_id:y.value}}).then(s=>{r.value=s.data,w.value=s.data}).finally(()=>f.value=!1)}function U(){if(!h.value){r.value=w.value;return}const s=h.value.toLowerCase();r.value=w.value.filter(e=>(e.proveedor||"").toLowerCase().includes(s)||(e.user?.name||"").toLowerCase().includes(s))}function E(s){_.$q.dialog({title:"Anular Compra",message:"¿Está seguro de anular la compra?",ok:"Sí",cancel:"No"}).onOk(()=>{f.value=!0,_.$axios.put(`/purchases/${s}/anular`).then(()=>{k()}).finally(()=>f.value=!1)})}function T(){const s=[{sheet:"Compras",columns:[{label:"Fecha",value:e=>$(e.fecha).format("DD/MM/YYYY HH:mm")},{label:"Proveedor",value:e=>e.proveedor},{label:"Usuario",value:e=>e.user?.username},{label:"Total",value:e=>e.total},{label:"Pago",value:e=>e.pago},{label:"Comentario",value:e=>e.comentario},{label:"Detalles",value:e=>e.details.map(t=>`${t.cantidad} ${t.productoName}`).join(", ")}],content:r.value}];W.export(s,"Compras")}return(s,e)=>(d(),V(K,{class:"q-pa-xs"},{default:o(()=>[l(q,{flat:"",bordered:""},{default:o(()=>[l(B,{class:"q-pa-xs"},{default:o(()=>[l(j,{onSubmit:S(k,["prevent"])},{default:o(()=>[a("div",X,[a("div",Z,[l(F,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",ee,[l(F,{modelValue:Q.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Q.value=t),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),s.$store.user.role==="Admin"?(d(),m("div",le,[l(O,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),label:"Usuario",outlined:"",dense:"",options:D.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])])):M("",!0),a("div",ae,[l(Y,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:f.value},null,8,["loading"])]),a("div",oe,[l(Y,{label:"Excel",color:"green",icon:"fa-solid fa-file-excel","no-caps":"",loading:f.value,onClick:T},null,8,["loading"])]),a("div",te,[l(F,{modelValue:h.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>h.value=t),U],label:"Filtro",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),a("div",se,[l(Y,{style:{width:"150px"},label:"Nueva Compra",color:"positive","no-caps":"",icon:"add_circle_outline",onClick:e[4]||(e[4]=t=>s.$router.push("/compras/add"))})])])]),_:1}),s.$store.user.role==="Admin"?(d(),m("div",ne,[a("div",de,[l(g,{bordered:"",padding:"",dense:""},{default:o(()=>[l(b,null,{default:o(()=>[l(c,{avatar:""},{default:o(()=>[l(x,{color:"indigo","text-color":"white",icon:"inventory_2"})]),_:1}),l(c,null,{default:o(()=>[l(p,null,{default:o(()=>[a("b",null,n(r.value.length),1),e[5]||(e[5]=v(" compras"))]),_:1}),l(p,{caption:""},{default:o(()=>e[6]||(e[6]=[v("Cantidad de compras")])),_:1})]),_:1})]),_:1})]),_:1})]),a("div",re,[l(g,{bordered:"",padding:"",dense:""},{default:o(()=>[l(b,null,{default:o(()=>[l(c,{avatar:""},{default:o(()=>[l(x,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(c,null,{default:o(()=>[l(p,null,{default:o(()=>[a("b",null,"Bs "+n(r.value.filter(t=>!t.anulado).reduce((t,u)=>t+parseFloat(u.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:""},{default:o(()=>e[7]||(e[7]=[v("Total de compras")])),_:1})]),_:1})]),_:1})]),_:1})]),a("div",ue,[l(g,{bordered:"",padding:"",dense:""},{default:o(()=>[l(b,null,{default:o(()=>[l(c,{avatar:""},{default:o(()=>[l(x,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(c,null,{default:o(()=>[l(p,null,{default:o(()=>[a("b",null,"Bs "+n(r.value.filter(t=>t.anulado).reduce((t,u)=>t+parseFloat(u.total),0).toFixed(2)),1)]),_:1}),l(p,{caption:""},{default:o(()=>e[8]||(e[8]=[v("Total de compras anuladas")])),_:1})]),_:1})]),_:1})]),_:1})])])):M("",!0)]),_:1})]),_:1}),l(q,{flat:"",bordered:"",class:"q-mt-md"},{default:o(()=>[l(B,null,{default:o(()=>[l(G,{dense:"",flat:"",bordered:"","wrap-cells":""},{default:o(()=>[e[10]||(e[10]=a("thead",null,[a("tr",{class:"bg-teal text-white"},[a("th",null,"Acciones"),a("th",null,"Fecha"),a("th",null,"Total"),a("th",null,"Proveedor"),a("th",null,"Usuario"),a("th",null,"Detalle"),a("th",null,"Pago"),a("th",null,"Comentario")])],-1)),a("tbody",null,[(d(!0),m(A,null,I(r.value,t=>(d(),m("tr",{key:t.id},[a("td",null,[t.anulado?(d(),m("div",ie,[l(J,{color:"red","text-color":"white",label:"Anulada"})])):(d(),V(z,{key:0,label:"Opciones","no-caps":"","dropdown-icon":"more_vert",color:"indigo",size:"10px"},{default:o(()=>[l(g,null,{default:o(()=>[H((d(),V(b,{clickable:"",onClick:u=>E(t.id)},{default:o(()=>[l(c,{avatar:""},{default:o(()=>[l(x,{icon:"delete"})]),_:1}),l(c,null,{default:o(()=>[l(p,null,{default:o(()=>e[9]||(e[9]=[v("Anular")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[R]])]),_:2},1024)]),_:2},1024))]),a("td",null,n(s.$filters.dateDmYHis(t.fecha)),1),a("td",ce,n(t.total),1),a("td",null,n(t.proveedor),1),a("td",null,n(t.user?.username),1),a("td",null,[a("div",me,[(d(!0),m(A,null,I(t.details,u=>(d(),m("span",{key:u.id},n(u.cantidad)+" "+n(u.productoName)+", ",1))),128))])]),a("td",null,n(t.pago),1),a("td",null,[a("div",pe,n(t.comentario),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{De as default};

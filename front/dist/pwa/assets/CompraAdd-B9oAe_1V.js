import{g as A,r as u,a1 as R,k as I,c as S,o as i,w as r,b as e,a as t,f as p,Q as w,e as b,aw as U,at as k,a8 as L,a7 as m,a9 as Q,aa as P,t as s,a4 as J,J as q,aY as E,h as Y}from"./index-Cnkfwu2V.js";import{Q as F}from"./QForm-BuBr56Z8.js";import{Q as j}from"./QPagination-CdEJbs2L.js";import{Q as G}from"./QChip-hsuLbat0.js";import{Q as $}from"./QMarkupTable-BKUCw7Jj.js";import{Q as N}from"./QSpace-DA2-N-zc.js";import{Q as H}from"./QSelect-D4GhvyBI.js";import{Q as K}from"./QPage-BmTFFvxK.js";import"./format-DyQxkAtJ.js";import"./QMenu-5MsTfl0N.js";import"./QItemLabel-CCL8uUdM.js";const O={class:"row"},W={class:"col-12"},X={class:"col-12 col-md-7"},Z={class:"row"},ee={class:"col-12 col-md-8"},oe={class:"col-12 col-md-2 flex flex-center"},le={class:"row"},te={class:"col-12 flex flex-center"},ae=["onClick"],re={class:"text-right"},se={class:"col-12 col-md-5"},de={class:"row items-center"},ne={style:{"max-width":"180px","line-height":".95"}},ue=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],ce={class:"text-right"},pe={class:"text-right text-bold"},me={class:"row q-col-gutter-sm"},ve={class:"col-12 col-md-6"},fe={class:"col-6 col-md-3"},ge={class:"col-12"},Ce={class:"col-12"},be={class:"text-right"},xe={class:"text-right"},he={class:"text-right text-bold"},_e={class:"col-12 q-pa-xs"},Fe={__name:"CompraAdd",setup(Ve){const{proxy:c}=A(),B=u([]),x=u(1),h=u(1),_=u(""),d=u([]),v=u(!1),f=u(!1),n=u({proveedor:"SN",pago:"Efectivo",comentario:""});R(()=>{V()});function V(){c.$axios.get("/productos",{params:{filter:_.value,page:x.value,limit:20}}).then(a=>{B.value=a.data.data,h.value=a.data.last_page})}function T(a){const o=d.value.find(l=>l.id===a.id);o?o.cantidadCompra++:d.value.push({...a,cantidadCompra:1,precioCompra:parseFloat(a.precioCompra??0)||0})}function z(a){d.value.splice(a,1)}const y=I(()=>d.value.reduce((a,o)=>a+o.cantidadCompra*o.precioCompra,0).toFixed(2));function D(){if(d.value.length===0){c.$alert.error("El carrito está vacío");return}f.value=!0}function M(){if(d.value.length===0){c.$alert.error("El carrito está vacío");return}v.value=!0,c.$axios.post("/purchases",{proveedor:n.value.proveedor,pago:n.value.pago,comentario:n.value.comentario,total:parseFloat(y.value),productos:d.value.map(a=>({id:a.id,cantidad:a.cantidadCompra,precio:a.precioCompra}))}).then(a=>{c.$alert.success("Compra registrada con éxito"),f.value=!1,d.value=[],n.value={proveedor:"SN",pago:"Efectivo",comentario:""},c.$router.push("/compras")}).catch(a=>{c.$alert.error(a.response?.data?.message||"Error al registrar compra")}).finally(()=>v.value=!1)}return(a,o)=>(i(),S(K,{class:"q-pa-xs"},{default:r(()=>[e("div",O,[e("div",W,[t(p,{label:"Atrás",color:"primary","no-caps":"",icon:"arrow_back",size:"10px",onClick:o[0]||(o[0]=l=>a.$router.push("/compras"))})]),e("div",X,[t(w,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(b,null,{default:r(()=>[t(F,{onSubmit:U(V,["prevent"])},{default:r(()=>[e("div",Z,[e("div",ee,[t(k,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=l=>_.value=l),label:"Buscar producto",outlined:"",dense:"",debounce:"300",clearable:""},null,8,["modelValue"])]),e("div",oe,[t(p,{label:"Buscar",color:"primary","no-caps":"",icon:"search",size:"10px",type:"submit"})])])]),_:1}),e("div",le,[e("div",te,[h.value>1?(i(),S(j,{key:0,modelValue:x.value,"onUpdate:modelValue":[o[2]||(o[2]=l=>x.value=l),V],max:h.value,"max-pages":5,"boundary-numbers":"",color:"black"},null,8,["modelValue","max"])):L("",!0)])]),t($,{dense:"",bordered:"",flat:""},{default:r(()=>[o[9]||(o[9]=e("thead",null,[e("tr",null,[e("th",null,"Cod"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"P. Compra"),e("th",null,"Stock")])],-1)),e("tbody",null,[(i(!0),m(Q,null,P(B.value,l=>(i(),m("tr",{key:l.id,onClick:g=>T(l),style:{cursor:"pointer"}},[e("td",null,s(l.codigo),1),e("td",null,s(l.nombre),1),e("td",null,[t(G,{dense:"",color:"teal",size:"10px"},{default:r(()=>[J(s(l.tipo),1)]),_:2},1024)]),e("td",re,s(l.precioCompra),1),e("td",null,s(l.stock),1)],8,ae))),128))])]),_:1})]),_:1})]),_:1})]),e("div",se,[t(w,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(b,null,{default:r(()=>[e("div",de,[o[10]||(o[10]=e("div",{class:"text-h6"},"Carrito",-1)),t(N),t(p,{icon:"delete",color:"red",dense:"",loading:v.value,size:"10px",label:"Limpiar","no-caps":"",onClick:o[3]||(o[3]=l=>d.value=[])},null,8,["loading"])]),t($,{dense:"",flat:"",bordered:"","wrap-cells":"",class:"q-mt-sm"},{default:r(()=>[o[13]||(o[13]=e("thead",null,[e("tr",{class:"bg-teal text-white"},[e("th",null,"Producto"),e("th",null,"Cant."),e("th",null,"P. Compra"),e("th",null,"Subtotal"),e("th")])],-1)),e("tbody",null,[(i(!0),m(Q,null,P(d.value,(l,g)=>(i(),m("tr",{key:g},[e("td",ne,s(l.nombre),1),e("td",null,[q(e("input",{"onUpdate:modelValue":C=>l.cantidadCompra=C,type:"number",min:"1",style:{width:"60px"}},null,8,ue),[[E,l.cantidadCompra,void 0,{number:!0}]])]),e("td",null,[q(e("input",{"onUpdate:modelValue":C=>l.precioCompra=C,type:"number",step:"0.1",min:"0",style:{width:"90px"}},null,8,ie),[[E,l.precioCompra,void 0,{number:!0}]])]),e("td",ce,s((l.cantidadCompra*l.precioCompra).toFixed(2))+" Bs",1),e("td",null,[t(p,{icon:"delete",color:"red",dense:"",size:"10px",onClick:C=>z(g)},null,8,["onClick"])])]))),128))]),e("tfoot",null,[e("tr",null,[o[11]||(o[11]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",pe,s(y.value)+" Bs",1),o[12]||(o[12]=e("td",null,null,-1))])])]),_:1}),t(p,{class:"full-width q-mt-md",color:"positive","no-caps":"",label:"Registrar Compra",loading:v.value,onClick:D},null,8,["loading"])]),_:1})]),_:1})])]),t(Y,{modelValue:f.value,"onUpdate:modelValue":o[8]||(o[8]=l=>f.value=l)},{default:r(()=>[t(w,{flat:"",bordered:"",style:{"max-width":"750px"}},{default:r(()=>[t(b,{class:"row items-center q-pb-none"},{default:r(()=>[o[14]||(o[14]=e("div",{class:"text-bold"},"Registrar Compra",-1)),t(N),t(p,{flat:"",dense:"",round:"",icon:"close",onClick:o[4]||(o[4]=l=>f.value=!1)})]),_:1}),t(b,null,{default:r(()=>[t(F,{onSubmit:U(M,["prevent"])},{default:r(()=>[e("div",me,[e("div",ve,[t(k,{modelValue:n.value.proveedor,"onUpdate:modelValue":o[5]||(o[5]=l=>n.value.proveedor=l),label:"Proveedor",outlined:"",dense:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),e("div",fe,[t(H,{modelValue:n.value.pago,"onUpdate:modelValue":o[6]||(o[6]=l=>n.value.pago=l),options:["Efectivo","Transferencia","Qr"],label:"Pago",outlined:"",dense:""},null,8,["modelValue"])]),e("div",ge,[t(k,{modelValue:n.value.comentario,"onUpdate:modelValue":o[7]||(o[7]=l=>n.value.comentario=l),label:"Comentario",type:"textarea",rows:"2",outlined:"",dense:""},null,8,["modelValue"])]),e("div",Ce,[t($,{dense:"",flat:"",bordered:""},{default:r(()=>[o[16]||(o[16]=e("thead",null,[e("tr",{class:"bg-teal text-white"},[e("th",null,"Producto"),e("th",null,"Cant."),e("th",null,"P. Compra"),e("th",null,"Subtotal")])],-1)),e("tbody",null,[(i(!0),m(Q,null,P(d.value,(l,g)=>(i(),m("tr",{key:g},[e("td",null,s(l.nombre),1),e("td",null,s(l.cantidadCompra),1),e("td",be,s(l.precioCompra)+" Bs",1),e("td",xe,s((l.cantidadCompra*l.precioCompra).toFixed(2))+" Bs",1)]))),128))]),e("tfoot",null,[e("tr",null,[o[15]||(o[15]=e("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),e("td",he,s(y.value)+" Bs",1)])])]),_:1})]),e("div",_e,[t(p,{class:"full-width",color:"positive",type:"submit","no-caps":"",label:"Confirmar Compra",loading:v.value},null,8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Fe as default};
